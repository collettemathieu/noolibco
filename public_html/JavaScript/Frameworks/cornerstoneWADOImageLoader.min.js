/*! cornerstone-wado-image-loader - v0.7.2 - 2015-09-18 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneWADOImageLoader */
if(typeof cornerstone==="undefined"){cornerstone={}}if(typeof cornerstoneWADOImageLoader==="undefined"){cornerstoneWADOImageLoader={internal:{options:{beforeSend:function(a){}},multiFrameCacheHack:{}}}}(function(a){function b(d,g,f){var e=d.uint16("x00280006");if(e===0){a.convertRGBColorByPixel(g,f)}else{a.convertRGBColorByPlane(g,f)}}function c(g,h,k){var l=h.uint16("x00280010");var e=h.uint16("x00280011");var i=h.string("x00280004");g.height=l;g.width=e;var f=g.getContext("2d");var d=f.createImageData(e,l);var m=$.Deferred();try{if(i==="RGB"){b(h,k,d.data)}else{if(i==="YBR_RCT"){b(h,k,d.data)}else{if(i==="YBR_ICT"){b(h,k,d.data)}else{if(i==="PALETTE COLOR"){a.convertPALETTECOLOR(k,d.data,h)}else{if(i==="YBR_FULL_422"){a.convertYBRFull(k,d.data)}else{if(i==="YBR_FULL"){a.convertYBRFull(k,d.data)}else{throw"no color space conversion for photometric interpretation "+i}}}}}}m.resolve(d);return m}catch(j){m.reject(j);return m}}a.convertColorSpace=c}(cornerstoneWADOImageLoader));(function(b){function a(m,r,k){var l=k.int16("x00281101",0);var d=k.int16("x00281101",1);var q=k.int16("x00281101",2);var f=(q===8?0:8);var h=k.byteArray.buffer;var p=new Uint16Array(h,k.elements.x00281201.dataOffset,l);var o=new Uint16Array(h,k.elements.x00281202.dataOffset,l);var g=new Uint16Array(h,k.elements.x00281203.dataOffset,l);var e=k.uint16("x00280010")*k.uint16("x00280011");var s=0;var c=0;for(var j=0;j<e;++j){var n=m[s++];if(n<d){n=0}else{if(n>d+l-1){n=l-1}else{n=n-d}}r[c++]=p[n]>>f;r[c++]=o[n]>>f;r[c++]=g[n]>>f;r[c++]=255}}b.convertPALETTECOLOR=a}(cornerstoneWADOImageLoader));(function(a){function b(e,d){if(e===undefined){throw"decodeRGB: rgbBuffer must not be undefined"}if(e.length%3!==0){throw"decodeRGB: rgbBuffer length must be divisible by 3"}var h=e.length/3;var f=0;var g=0;for(var c=0;c<h;c++){d[g++]=e[f++];d[g++]=e[f++];d[g++]=e[f++];d[g++]=255}}a.convertRGBColorByPixel=b}(cornerstoneWADOImageLoader));(function(a){function b(f,e){if(f===undefined){throw"decodeRGB: rgbBuffer must not be undefined"}if(f.length%3!==0){throw"decodeRGB: rgbBuffer length must be divisible by 3"}var k=f.length/3;var j=0;for(var d=0;d<k;d++){var h=0;var g=k;var c=k*2;for(var d=0;d<k;d++){e[j++]=f[h++];e[j++]=f[g++];e[j++]=f[c++];e[j++]=255}}}a.convertRGBColorByPlane=b}(cornerstoneWADOImageLoader));(function(a){function b(j,l){if(j===undefined){throw"decodeRGB: ybrBuffer must not be undefined"}if(j.length%3!==0){throw"decodeRGB: ybrBuffer length must be divisble by 3"}var d=j.length/3;var k=0;var c=0;for(var f=0;f<d;f++){var h=j[k++];var e=j[k++];var g=j[k++];l[c++]=h+1.402*(g-128);l[c++]=h-0.34414*(e-128)-0.71414*(g-128);l[c++]=h+1.772*(e-128);l[c++]=255}}a.convertYBRFull=b}(cornerstoneWADOImageLoader));(function(b){function a(c){b.internal.options=c}b.configure=a}(cornerstoneWADOImageLoader));(function(b){function a(f,e,g){if(g===undefined){g=0}var d=f.string("x00280004");var c=b.isColorImage(d);if(c===false){return b.makeGrayscaleImage(e,f,g)}else{return b.makeColorImage(e,f,g)}}b.createImageObject=a}(cornerstoneWADOImageLoader));(function(d,c,b){function a(i,g){var m=i.uint16("x00280010");var f=i.uint16("x00280011");var e=dicomParser.readEncapsulatedPixelData(i,i.elements.x7fe00010,g);var j=new JpxImage();j.parse(e);var l=j.width;var o=j.height;if(l!==f){throw"JPEG2000 decoder returned width of "+l+", when "+f+" is expected"}if(o!==m){throw"JPEG2000 decoder returned width of "+o+", when "+m+" is expected"}var h=j.tiles.length;if(h!==1){throw"JPEG2000 decoder returned a tileCount of "+h+", when 1 is expected"}var k=j.tiles[0];var n=k.items;return n}b.decodeJPEG2000=a}($,cornerstone,cornerstoneWADOImageLoader));(function(c,b,a){function d(h,l){var f=h.elements.x7fe00010;var e=h.uint16("x00280010");var j=h.uint16("x00280011");var k=h.uint16("x00280100");var i=dicomParser.readEncapsulatedPixelData(h,f,l);var g=new JpegImage();g.parse(i);if(k===8){return g.getData(j,e)}else{if(k===16){return g.getData16(j,e)}}}a.decodeJPEGBaseline=d}($,cornerstone,cornerstoneWADOImageLoader));(function(d){function c(f){return a(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(f))))}function a(h){var f;try{return decodeURIComponent(escape(h))}catch(g){f=g;if(f instanceof URIError){return h}else{throw f}}}function b(i,j,h){var m=$.Deferred();var l=j.uint16("x00280010");var g=j.uint16("x00280011");i.height=l;i.width=g;var n=dicomParser.readEncapsulatedPixelData(j,j.elements.x7fe00010,h);var k=new Blob([n],{type:"image/jpeg"});var f=new FileReader();if(f.readAsBinaryString===undefined){f.readAsArrayBuffer(k)}else{f.readAsBinaryString(k)}f.onload=function(){var o=new Image();o.onload=function(){var p=i.getContext("2d");p.drawImage(this,0,0);var q=p.getImageData(0,0,g,l);m.resolve(q)};o.onerror=function(p){m.reject(p)};if(f.readAsBinaryString===undefined){o.src="data:image/jpeg;base64,"+window.btoa(c(f.result))
}else{o.src="data:image/jpeg;base64,"+window.btoa(f.result)}};return m}function e(g){var f=g.string("x00020010");var h=g.uint16("x00280100");if((h===8)&&f==="1.2.840.10008.1.2.4.50"){return true}}d.decodeJPEGBaseline8Bit=b;d.isJPEGBaseline8Bit=e}(cornerstoneWADOImageLoader));"use strict";(function(a){function b(h,d){var i=h.elements.x7fe00010;var g=h.uint16("x00280100");var f=h.uint16("x00280103");var j=dicomParser.readEncapsulatedPixelData(h,i,d);var c=g<=8?1:2;var e=new jpeg.lossless.Decoder();var k=e.decode(j.buffer,j.byteOffset,j.length,c);if(f===0){if(c===2){return new Uint16Array(k.buffer)}else{return new Uint8Array(k.buffer)}}else{return new Int16Array(k.buffer)}}a.decodeJPEGLossless=b}(cornerstoneWADOImageLoader));(function(c){function d(j,f){var n=j.uint16("x00280010");var e=j.uint16("x00280011");var k=j.uint16("x00280002");var l=j.elements.x7fe00010;var m=dicomParser.readEncapsulatedPixelData(j,l,f);var g=c.getPixelFormat(j);var h=e*n;var i;if(g===1){i=new ArrayBuffer(h*k);b(m,i,h,k);return new Uint8Array(i)}else{if(g===2){i=new ArrayBuffer(h*k*2);a(m,i,h);return new Uint16Array(i)}else{if(g===3){i=new ArrayBuffer(h*k*2);a(m,i,h);return new Int16Array(i)}}}}function b(u,f,h,w){var p=new DataView(u.buffer,u.byteOffset);var o=new DataView(u.buffer,u.byteOffset);var l=new DataView(f);var q=0;var t=p.getInt32(0,true);for(var y=0;y<t;++y){q=y;var x=p.getInt32((y+1)*4,true);var g=p.getInt32((y+2)*4,true);if(g===0){g=u.length}var r=h*t;while(x<g){var e=o.getInt8(x++);if(e>=0&&e<=127){for(var m=0;m<e+1&&q<r;++m){l.setInt8(q,o.getInt8(x++));q+=w}}else{if(e<=-1&&e>=-127){var v=o.getInt8(x++);for(var k=0;k<-e+1&&q<r;++k){l.setInt8(q,v);q+=w}}else{if(e===-128){}}}}}}function a(u,f,k){var q=new DataView(u.buffer,u.byteOffset);var p=new DataView(u.buffer,u.byteOffset);var m=new DataView(f);var t=q.getInt32(0,true);for(var x=0;x<t;++x){var r=0;var g=(x===0?1:0);var w=q.getInt32((x+1)*4,true);var h=q.getInt32((x+2)*4,true);if(h===0){h=u.length}while(w<h){var e=p.getInt8(w++);if(e>=0&&e<=127){for(var o=0;o<e+1&&r<k;++o){m.setInt8((r*2)+g,p.getInt8(w++));r++}}else{if(e<=-1&&e>=-127){var v=p.getInt8(w++);for(var l=0;l<-e+1&&r<k;++l){m.setInt8((r*2)+g,v);r++}}else{if(e===-128){}}}}}}c.decodeRLE=d}(cornerstoneWADOImageLoader));(function(a){function b(d,e){var c=d.string("x00020010");if(c==="1.2.840.10008.1.2"){return a.extractUncompressedPixels(d,e)}else{if(c==="1.2.840.10008.1.2.1"){return a.extractUncompressedPixels(d,e)}else{if(c==="1.2.840.10008.1.2.4.90"){return a.decodeJPEG2000(d,e)}else{if(c==="1.2.840.10008.1.2.4.91"){return a.decodeJPEG2000(d,e)}else{if(c==="1.2.840.10008.1.2.5"){return a.decodeRLE(d,e)}else{if(c==="1.2.840.10008.1.2.4.50"){return a.decodeJPEGBaseline(d,e)}else{if(c==="1.2.840.10008.1.2.4.51"){return a.decodeJPEGBaseline(d,e)}else{if(c==="1.2.840.10008.1.2.4.57"){return a.decodeJPEGLossless(d,e)}else{if(c==="1.2.840.10008.1.2.4.70"){return a.decodeJPEGLossless(d,e)}else{throw"no decoder for transfer syntax "+c}}}}}}}}}}a.decodeTransferSyntax=b}(cornerstoneWADOImageLoader));var ColorSpace={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4};var JpegImage=(function jpegImage(){var g=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);var f=4017;var o=799;var d=3406;var n=2276;var b=1567;var l=3784;var i=5793;var e=2896;function t(){}function h(B,C){var y=0,w=[],A,z,x=16;while(x>0&&!B[x-1]){x--}w.push({children:[],index:0});var v=w[0],u;for(A=0;A<x;A++){for(z=0;z<B[A];z++){v=w.pop();v.children[v.index]=C[y];while(v.index>0){v=w.pop()}v.index++;w.push(v);while(w.length<=A){w.push(u={children:[],index:0});v.children[v.index]=u.children;v=u}y++}if(A+1<x){w.push(u={children:[],index:0});v.children[v.index]=u.children;v=u}}return w[0].children}function q(v,w,u){return 64*((v.blocksPerLine+1)*w+u)}function c(am,Y,w,R,S,F,J,O,ad){var ak=w.precision;var G=w.samplesPerLine;var E=w.scanLines;var I=w.mcusPerLine;var M=w.progressive;var T=w.maxH,Q=w.maxV;var A=Y,C=0,H=0;function aa(){if(H>0){H--;return(C>>H)&1}C=am[Y++];if(C==255){var v=am[Y++];if(v){throw"unexpected marker: "+((C<<8)|v).toString(16)}}H=7;return C>>>7}function N(v){var ao=v;var ap;while((ap=aa())!==null){ao=ao[ap];if(typeof ao==="number"){return ao}if(typeof ao!=="object"){throw"invalid huffman sequence"}}return null}function x(v){var ap=0;while(v>0){var ao=aa();if(ao===null){return}ap=(ap<<1)|ao;v--}return ap}function W(v){var ao=x(v);if(ao>=1<<(v-1)){return ao}return ao+(-1<<v)+1}function V(at,aq){var av=N(at.huffmanTableDC);var au=av===0?0:W(av);at.blockData[aq]=(at.pred+=au);var ao=1;while(ao<64){var ap=N(at.huffmanTableAC);var aw=ap&15,v=ap>>4;if(aw===0){if(v<15){break}ao+=16;continue}ao+=v;var ar=g[ao];at.blockData[aq+ar]=W(aw);ao++}}function y(v,aq){var ao=N(v.huffmanTableDC);var ap=ao===0?0:(W(ao)<<ad);v.blockData[aq]=(v.pred+=ap)}function K(v,ao){v.blockData[ao]|=aa()<<ad}var P=0;function u(ap,av){if(P>0){P--;
return}var ao=F,at=J;while(ao<=at){var v=N(ap.huffmanTableAC);var aq=v&15,ar=v>>4;if(aq===0){if(ar<15){P=x(ar)+(1<<ar)-1;break}ao+=16;continue}ao+=ar;var au=g[ao];ap.blockData[av+au]=W(aq)*(1<<ad);ao++}}var L=0,B;function U(ap,av){var ao=F,at=J,ar=0;while(ao<=at){var au=g[ao];switch(L){case 0:var v=N(ap.huffmanTableAC);var aq=v&15;ar=v>>4;if(aq===0){if(ar<15){P=x(ar)+(1<<ar);L=4}else{ar=16;L=1}}else{if(aq!==1){throw"invalid ACn encoding"}B=W(aq);L=ar?2:3}continue;case 1:case 2:if(ap.blockData[av+au]){ap.blockData[av+au]+=(aa()<<ad)}else{ar--;if(ar===0){L=L==2?3:0}}break;case 3:if(ap.blockData[av+au]){ap.blockData[av+au]+=(aa()<<ad)}else{ap.blockData[av+au]=B<<ad;L=0}break;case 4:if(ap.blockData[av+au]){ap.blockData[av+au]+=(aa()<<ad)}break}ao++}if(L===4){P--;if(P===0){L=0}}}function X(aw,v,ao,ax,ap){var aq=(ao/I)|0;var au=ao%I;var at=aq*aw.v+ax;var av=au*aw.h+ap;var ar=q(aw,at,av);v(aw,ar)}function af(ao,ar,ap){var aq=(ap/ao.blocksPerLine)|0;var v=ap%ao.blocksPerLine;var at=q(ao,aq,v);ar(ao,at)}var al=R.length;var aj,ah,ag,ae,ac;var D;if(M){if(F===0){D=O===0?y:K}else{D=O===0?u:U}}else{D=V}var ab=0,an;var z;if(al==1){z=R[0].blocksPerLine*R[0].blocksPerColumn}else{z=I*w.mcusPerColumn}if(!S){S=z}var ai,Z;while(ab<z){for(ah=0;ah<al;ah++){R[ah].pred=0}P=0;if(al==1){aj=R[0];for(ac=0;ac<S;ac++){af(aj,D,ab);ab++}}else{for(ac=0;ac<S;ac++){for(ah=0;ah<al;ah++){aj=R[ah];ai=aj.h;Z=aj.v;for(ag=0;ag<Z;ag++){for(ae=0;ae<ai;ae++){X(aj,D,ab,ag,ae)}}}ab++}}H=0;an=(am[Y]<<8)|am[Y+1];if(an<=65280){throw"marker was not found"}if(an>=65488&&an<=65495){Y+=2}else{break}}return Y-A}function r(F,u,I){var K=F.quantizationTable;var B,A,z,y,x,w,v,L,G;var J;for(J=0;J<64;J++){I[J]=F.blockData[u+J]*K[J]}for(J=0;J<8;++J){var D=8*J;if(I[1+D]===0&&I[2+D]===0&&I[3+D]===0&&I[4+D]===0&&I[5+D]===0&&I[6+D]===0&&I[7+D]===0){G=(i*I[0+D]+512)>>10;I[0+D]=G;I[1+D]=G;I[2+D]=G;I[3+D]=G;I[4+D]=G;I[5+D]=G;I[6+D]=G;I[7+D]=G;continue}B=(i*I[0+D]+128)>>8;A=(i*I[4+D]+128)>>8;z=I[2+D];y=I[6+D];x=(e*(I[1+D]-I[7+D])+128)>>8;L=(e*(I[1+D]+I[7+D])+128)>>8;w=I[3+D]<<4;v=I[5+D]<<4;G=(B-A+1)>>1;B=(B+A+1)>>1;A=G;G=(z*l+y*b+128)>>8;z=(z*b-y*l+128)>>8;y=G;G=(x-v+1)>>1;x=(x+v+1)>>1;v=G;G=(L+w+1)>>1;w=(L-w+1)>>1;L=G;G=(B-y+1)>>1;B=(B+y+1)>>1;y=G;G=(A-z+1)>>1;A=(A+z+1)>>1;z=G;G=(x*n+L*d+2048)>>12;x=(x*d-L*n+2048)>>12;L=G;G=(w*o+v*f+2048)>>12;w=(w*f-v*o+2048)>>12;v=G;I[0+D]=B+L;I[7+D]=B-L;I[1+D]=A+v;I[6+D]=A-v;I[2+D]=z+w;I[5+D]=z-w;I[3+D]=y+x;I[4+D]=y-x}for(J=0;J<8;++J){var C=J;if(I[1*8+C]===0&&I[2*8+C]===0&&I[3*8+C]===0&&I[4*8+C]===0&&I[5*8+C]===0&&I[6*8+C]===0&&I[7*8+C]===0){G=(i*I[J+0]+8192)>>14;I[0*8+C]=G;I[1*8+C]=G;I[2*8+C]=G;I[3*8+C]=G;I[4*8+C]=G;I[5*8+C]=G;I[6*8+C]=G;I[7*8+C]=G;continue}B=(i*I[0*8+C]+2048)>>12;A=(i*I[4*8+C]+2048)>>12;z=I[2*8+C];y=I[6*8+C];x=(e*(I[1*8+C]-I[7*8+C])+2048)>>12;L=(e*(I[1*8+C]+I[7*8+C])+2048)>>12;w=I[3*8+C];v=I[5*8+C];G=(B-A+1)>>1;B=(B+A+1)>>1;A=G;G=(z*l+y*b+2048)>>12;z=(z*b-y*l+2048)>>12;y=G;G=(x-v+1)>>1;x=(x+v+1)>>1;v=G;G=(L+w+1)>>1;w=(L-w+1)>>1;L=G;G=(B-y+1)>>1;B=(B+y+1)>>1;y=G;G=(A-z+1)>>1;A=(A+z+1)>>1;z=G;G=(x*n+L*d+2048)>>12;x=(x*d-L*n+2048)>>12;L=G;G=(w*o+v*f+2048)>>12;w=(w*f-v*o+2048)>>12;v=G;I[0*8+C]=B+L;I[7*8+C]=B-L;I[1*8+C]=A+v;I[6*8+C]=A-v;I[2*8+C]=z+w;I[5*8+C]=z-w;I[3*8+C]=y+x;I[4*8+C]=y-x}for(J=0;J<64;++J){var E=u+J;var H=I[J];H=(H<=-2056/F.bitConversion)?0:(H>=2024/F.bitConversion)?255/F.bitConversion:(H+2056/F.bitConversion)>>4;F.blockData[E]=H}}function a(u,E){var G=[];var F=E.blocksPerLine;var A=E.blocksPerColumn;var v=F<<3;var B=new Int32Array(64);var y,x,D=0;for(var z=0;z<A;z++){for(var C=0;C<F;C++){var w=q(E,z,C);r(E,w,B)}}return E.blockData}function s(u){return u<=0?0:u>=255?255:u|0}t.prototype={load:function j(y){var w=(function(B){this.parse(B);if(this.onload){this.onload()}}).bind(this);if(y.indexOf("data:")>-1){var A=y.indexOf("base64,")+7;var x=atob(y.substring(A));var u=new Uint8Array(x.length);for(var v=x.length-1;v>=0;v--){u[v]=x.charCodeAt(v)}w(x)}else{var z=new XMLHttpRequest();z.open("GET",y,true);z.responseType="arraybuffer";z.onload=(function(){var B=new Uint8Array(z.response);w(B)}).bind(this);z.send(null)}},parse:function p(ap){function ah(){var v=(ap[ad]<<8)|ap[ad+1];ad+=2;return v}function L(){var v=ah();var z=ap.subarray(ad,ad+v-2);ad+=z.length;return z}function Z(ar){var v=Math.ceil(ar.samplesPerLine/8/ar.maxH);var at=Math.ceil(ar.scanLines/8/ar.maxV);for(var au=0;au<ar.components.length;au++){ao=ar.components[au];var ay=Math.ceil(Math.ceil(ar.samplesPerLine/8)*ao.h/ar.maxH);var av=Math.ceil(Math.ceil(ar.scanLines/8)*ao.v/ar.maxV);var ax=v*ao.h;var z=at*ao.v;var aw=64*z*(ax+1);ao.blockData=new Int16Array(aw);ao.blocksPerLine=ay;ao.blocksPerColumn=av}ar.mcusPerLine=v;ar.mcusPerColumn=at}var ad=0,O=ap.length;var N=null;var X=null;var E=null;var u,U;var Y=[];var y=[],B=[];var x=ah();if(x!=65496){throw"SOI not found"}x=ah();while(x!=65497){var al,ak,aj;switch(x){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var G=L();
if(x===65504){if(G[0]===74&&G[1]===70&&G[2]===73&&G[3]===70&&G[4]===0){N={version:{major:G[5],minor:G[6]},densityUnits:G[7],xDensity:(G[8]<<8)|G[9],yDensity:(G[10]<<8)|G[11],thumbWidth:G[12],thumbHeight:G[13],thumbData:G.subarray(14,14+3*G[12]*G[13])}}}if(x===65518){if(G[0]===65&&G[1]===100&&G[2]===111&&G[3]===98&&G[4]===101&&G[5]===0){X={version:G[6],flags0:(G[7]<<8)|G[8],flags1:(G[9]<<8)|G[10],transformCode:G[11]}}}break;case 65499:var M=ah();var K=M+ad-2;while(ad<K){var A=ap[ad++];var F=new Int32Array(64);if((A>>4)===0){for(ak=0;ak<64;ak++){var ab=g[ak];F[ab]=ap[ad++]}}else{if((A>>4)===1){for(ak=0;ak<64;ak++){var am=g[ak];F[am]=ah()}}else{throw"DQT: invalid table spec"}}Y[A&15]=F}break;case 65472:case 65473:case 65474:if(u){throw"Only single frame JPEGs supported"}ah();u={};u.extended=(x===65473);u.progressive=(x===65474);u.precision=ap[ad++];u.scanLines=ah();u.samplesPerLine=ah();u.components=[];u.componentIds={};var Q=ap[ad++],ac;var W=0,R=0;for(al=0;al<Q;al++){ac=ap[ad];var an=ap[ad+1]>>4;var ae=ap[ad+1]&15;if(W<an){W=an}if(R<ae){R=ae}var w=ap[ad+2];aj=u.components.push({h:an,v:ae,quantizationTable:Y[w],quantizationTableId:w,bitConversion:255/((1<<u.precision)-1)});u.componentIds[ac]=aj-1;ad+=3}u.maxH=W;u.maxV=R;Z(u);break;case 65476:var ag=ah();for(al=2;al<ag;){var C=ap[ad++];var aa=new Uint8Array(16);var V=0;for(ak=0;ak<16;ak++,ad++){V+=(aa[ak]=ap[ad])}var P=new Uint8Array(V);for(ak=0;ak<V;ak++,ad++){P[ak]=ap[ad]}al+=17+V;((C>>4)===0?B:y)[C&15]=h(aa,P)}break;case 65501:ah();U=ah();break;case 65498:var af=ah();var ai=ap[ad++];var T=[],ao;for(al=0;al<ai;al++){var aq=u.componentIds[ap[ad++]];ao=u.components[aq];var S=ap[ad++];ao.huffmanTableDC=B[S>>4];ao.huffmanTableAC=y[S&15];T.push(ao)}var D=ap[ad++];var I=ap[ad++];var H=ap[ad++];var J=c(ap,ad,u,T,U,D,I,H>>4,H&15);ad+=J;break;default:if(ap[ad-3]==255&&ap[ad-2]>=192&&ap[ad-2]<=254){ad-=3;break}throw"unknown JPEG marker "+x.toString(16)}x=ah()}this.width=u.samplesPerLine;this.height=u.scanLines;this.jfif=N;this.adobe=X;this.components=[];switch(u.components.length){case 1:this.colorspace=ColorSpace.Grayscale;break;case 3:if(this.adobe){this.colorspace=ColorSpace.AdobeRGB}else{this.colorspace=ColorSpace.RGB}break;case 4:this.colorspace=ColorSpace.CYMK;break;default:this.colorspace=ColorSpace.Unknown}for(var al=0;al<u.components.length;al++){var ao=u.components[al];if(!ao.quantizationTable&&ao.quantizationTableId!==null){ao.quantizationTable=Y[ao.quantizationTableId]}this.components.push({output:a(u,ao),scaleX:ao.h/u.maxH,scaleY:ao.v/u.maxV,blocksPerLine:ao.blocksPerLine,blocksPerColumn:ao.blocksPerColumn,bitConversion:ao.bitConversion})}},getData16:function k(N,M){if(this.components.length!==1){throw"Unsupported color mode"}var V=this.width/N,U=this.height/M;var L,B,A;var J,I,R;var D=0;var W=this.components.length;var H=N*M*W;var aa=new Uint16Array(H);var Y;var O=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(R=0;R<W;R++){L=this.components[R];var G=L.blocksPerLine;var X=L.blocksPerColumn;var u=G<<3;var Q,P,K=0;var T=0;for(var C=0;C<X;C++){var Z=C<<3;for(var z=0;z<G;z++){var F=q(L,C,z);var D=0,S=z<<3;for(Q=0;Q<8;Q++){var T=(Z+Q)*u;for(P=0;P<8;P++){O[T+S+P]=L.output[F+D++]}}}}B=L.scaleX*V;A=L.scaleY*U;D=R;var w,v;var E;for(I=0;I<M;I++){for(J=0;J<N;J++){v=0|(I*A);w=0|(J*B);E=v*u+w;aa[D]=O[E];D+=W}}}return aa},getData:function m(u,v){var ae=this.width/u,ac=this.height/v;var an,ad,ab;var ah,ag,al;var ai=0;var w,A,aq,H,Q,F,am,D,J,T;var P;var W=this.components.length;var N=u*v*W;var ar=new Uint8Array(N);var S;var aa=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(al=0;al<W;al++){an=this.components[al];var af=an.blocksPerLine;var at=an.blocksPerColumn;var E=af<<3;var ak,aj,Z=0;var I=0;for(var z=0;z<at;z++){var O=z<<3;for(var ap=0;ap<af;ap++){var ao=q(an,z,ap);var ai=0,L=ap<<3;for(ak=0;ak<8;ak++){var I=(O+ak)*E;for(aj=0;aj<8;aj++){aa[I+L+aj]=an.output[ao+ai++]*an.bitConversion}}}}ad=an.scaleX*ae;ab=an.scaleY*ac;ai=al;var V,U;var X;for(ag=0;ag<v;ag++){for(ah=0;ah<u;ah++){U=0|(ag*ab);V=0|(ah*ad);X=U*E+V;ar[ai]=aa[X];ai+=W}}}switch(W){case 1:case 2:break;case 3:P=true;if(this.adobe&&this.adobe.transformCode){P=true}else{if(typeof this.colorTransform!=="undefined"){P=!!this.colorTransform}}if(P){for(al=0;al<N;al+=W){w=ar[al];A=ar[al+1];aq=ar[al+2];D=s(w-179.456+1.402*aq);J=s(w+135.459-0.344*A-0.714*aq);T=s(w-226.816+1.772*A);ar[al]=D;ar[al+1]=J;ar[al+2]=T}}break;case 4:if(!this.adobe){throw"Unsupported color mode (4 components)"}P=false;if(this.adobe&&this.adobe.transformCode){P=true}else{if(typeof this.colorTransform!=="undefined"){P=!!this.colorTransform}}if(P){for(al=0;al<N;al+=W){w=ar[al];A=ar[al+1];aq=ar[al+2];Q=s(434.456-w-1.402*aq);F=s(119.541-w+0.344*A+0.714*aq);w=s(481.816-w-1.772*A);ar[al]=Q;ar[al+1]=F;ar[al+2]=w}}break;default:throw"Unsupported color mode"}return ar}};return t})();(function(b){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=b()
}else{if(typeof define==="function"&&define.amd){define([],b)}else{var a;if(typeof window!=="undefined"){a=window}else{if(typeof global!=="undefined"){a=global}else{if(typeof self!=="undefined"){a=self}else{a=this}}}a.jpeg=b()}}})(function(){var d,b,a;return(function c(f,k,h){function g(q,n){if(!k[q]){if(!f[q]){var m=typeof require=="function"&&require;if(!n&&m){return m(q,!0)}if(e){return e(q,!0)}var p=new Error("Cannot find module '"+q+"'");throw p.code="MODULE_NOT_FOUND",p}var i=k[q]={exports:{}};f[q][0].call(i.exports,function(l){var o=f[q][1][l];return g(o?o:l)},i,i.exports,c,f,k,h)}return k[q].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.ComponentSpec=f.lossless.ComponentSpec||function(){this.hSamp=0;this.quantTableSel=0;this.vSamp=0};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.ComponentSpec}},{}],2:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.DataStream=f.lossless.DataStream||function(k,l,j){this.buffer=new DataView(k,l,j);this.index=0};f.lossless.DataStream.prototype.get16=function(){var j=this.buffer.getUint16(this.index,false);this.index+=2;return j};f.lossless.DataStream.prototype.get8=function(){var j=this.buffer.getUint8(this.index);this.index+=1;return j};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.DataStream}},{}],3:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.DataStream=f.lossless.DataStream||((typeof g!=="undefined")?g("./data-stream.js"):null);f.lossless.HuffmanTable=f.lossless.HuffmanTable||((typeof g!=="undefined")?g("./huffman-table.js"):null);f.lossless.QuantizationTable=f.lossless.QuantizationTable||((typeof g!=="undefined")?g("./quantization-table.js"):null);f.lossless.ScanHeader=f.lossless.ScanHeader||((typeof g!=="undefined")?g("./scan-header.js"):null);f.lossless.FrameHeader=f.lossless.FrameHeader||((typeof g!=="undefined")?g("./frame-header.js"):null);f.lossless.Utils=f.lossless.Utils||((typeof g!=="undefined")?g("./utils.js"):null);f.lossless.Decoder=f.lossless.Decoder||function(j,k){this.buffer=j;this.frame=new f.lossless.FrameHeader();this.huffTable=new f.lossless.HuffmanTable();this.quantTable=new f.lossless.QuantizationTable();this.scan=new f.lossless.ScanHeader();this.DU=f.lossless.Utils.createArray(10,4,64);this.HuffTab=f.lossless.Utils.createArray(4,2,50*256);this.IDCT_Source=[];this.nBlock=[];this.acTab=f.lossless.Utils.createArray(10,1);this.dcTab=f.lossless.Utils.createArray(10,1);this.qTab=f.lossless.Utils.createArray(10,1);this.marker=0;this.markerIndex=0;this.numComp=0;this.restartInterval=0;this.selection=0;this.xDim=0;this.yDim=0;this.xLoc=0;this.yLoc=0;this.numBytes=0;this.outputData=null;if(typeof k!=="undefined"){this.numBytes=k}};f.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54];f.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];f.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50;f.lossless.Decoder.MSB=2147483648;f.lossless.Decoder.prototype.decompress=function(j,l,k){return this.decode(j,l,k).buffer};f.lossless.Decoder.prototype.decode=function(o,n,m,k){var r,j=0,l=[],p,s,u=[],q=[],t;if(typeof o!=="undefined"){this.buffer=o}if(typeof k!=="undefined"){this.numBytes=k}this.stream=new f.lossless.DataStream(this.buffer,n,m);this.buffer=null;this.xLoc=0;this.yLoc=0;r=this.stream.get16();if(r!==65496){throw new Error("Not a JPEG file")}r=this.stream.get16();while((((r>>4)!==4092)||(r===65476))){switch(r){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,f.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if((r>>8)!==255){throw new Error("ERROR: format throw new IOException! (decode)")}}r=this.stream.get16()}if((r<65472)||(r>65479)){throw new Error("ERROR: could not handle arithmetic code!")}this.frame.read(this.stream);r=this.stream.get16();do{while(r!==65498){switch(r){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,f.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();
break;case 65534:this.readComment();break;default:if((r>>8)!==255){throw new Error("ERROR: format throw new IOException! (Parser.decode)")}}r=this.stream.get16()}this.precision=this.frame.precision;this.components=this.frame.components;if(!this.numBytes){this.numBytes=parseInt(this.precision/8)}this.scan.read(this.stream);this.numComp=this.scan.numComp;this.selection=this.scan.selection;if(this.numBytes===1){if(this.numComp===3){this.getter=this.getValueRGB;this.setter=this.setValueRGB;this.output=this.outputRGB}else{this.getter=this.getValue8;this.setter=this.setValue8;this.output=this.outputSingle}}else{this.getter=this.getValue16;this.setter=this.setValue16;this.output=this.outputSingle}switch(this.selection){case 2:this.selector=this.select2;break;case 3:this.selector=this.select3;break;case 4:this.selector=this.select4;break;case 5:this.selector=this.select5;break;case 6:this.selector=this.select6;break;case 7:this.selector=this.select7;break;default:this.selector=this.select1;break}this.scanComps=this.scan.components;this.quantTables=this.quantTable.quantTables;for(p=0;p<this.numComp;p+=1){s=this.scanComps[p].scanCompSel;this.qTab[p]=this.quantTables[this.components[s].quantTableSel];this.nBlock[p]=this.components[s].vSamp*this.components[s].hSamp;this.dcTab[p]=this.HuffTab[this.scanComps[p].dcTabSel][0];this.acTab[p]=this.HuffTab[this.scanComps[p].acTabSel][1]}this.xDim=this.frame.dimX;this.yDim=this.frame.dimY;this.outputData=new DataView(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp));j+=1;while(true){u[0]=0;q[0]=0;for(p=0;p<10;p+=1){l[p]=(1<<(this.precision-1))}if(this.restartInterval===0){r=this.decodeUnit(l,u,q);while((r===0)&&((this.xLoc<this.xDim)&&(this.yLoc<this.yDim))){this.output(l);r=this.decodeUnit(l,u,q)}break}for(t=0;t<this.restartInterval;t+=1){r=this.decodeUnit(l,u,q);this.output(l);if(r!==0){break}}if(r===0){if(this.markerIndex!==0){r=(65280|this.marker);this.markerIndex=0}else{r=this.stream.get16()}}if(!((r>=65488)&&(r<=65495))){break}}if((r===65500)&&(j===1)){this.readNumber();r=this.stream.get16()}}while((r!==65497)&&((this.xLoc<this.xDim)&&(this.yLoc<this.yDim))&&(j===0));return this.outputData};f.lossless.Decoder.prototype.decodeUnit=function(l,j,k){if(this.numComp==1){return this.decodeSingle(l,j,k)}else{if(this.numComp==3){return this.decodeRGB(l,j,k)}else{return -1}}};f.lossless.Decoder.prototype.select1=function(j){return this.getPreviousX(j)};f.lossless.Decoder.prototype.select2=function(j){return this.getPreviousY(j)};f.lossless.Decoder.prototype.select3=function(j){return this.getPreviousXY(j)};f.lossless.Decoder.prototype.select4=function(j){return(this.getPreviousX(j)+this.getPreviousY(j))-this.getPreviousXY(j)};f.lossless.Decoder.prototype.select5=function(j){return this.getPreviousX(j)+((this.getPreviousY(j)-this.getPreviousXY(j))>>1)};f.lossless.Decoder.prototype.select6=function(j){return this.getPreviousY(j)+((this.getPreviousX(j)-this.getPreviousXY(j))>>1)};f.lossless.Decoder.prototype.select7=function(j){return((this.getPreviousX(j)+this.getPreviousY(j))/2)};f.lossless.Decoder.prototype.decodeRGB=function(l,u,p){var s,v,q,r,t,o,m,n;l[0]=this.selector(0);l[1]=this.selector(1);l[2]=this.selector(2);for(t=0;t<this.numComp;t+=1){r=this.qTab[t];v=this.acTab[t];q=this.dcTab[t];for(o=0;o<this.nBlock[t];o+=1){for(m=0;m<this.IDCT_Source.length;m+=1){this.IDCT_Source[m]=0}s=this.getHuffmanValue(q,u,p);if(s>=65280){return s}l[t]=this.IDCT_Source[0]=l[t]+this.getn(p,s,u,p);this.IDCT_Source[0]*=r[0];for(n=1;n<64;n+=1){s=this.getHuffmanValue(v,u,p);if(s>=65280){return s}n+=(s>>4);if((s&15)===0){if((s>>4)===0){break}}else{this.IDCT_Source[f.lossless.Decoder.IDCT_P[n]]=this.getn(p,s&15,u,p)*r[n]}}}}return 0};f.lossless.Decoder.prototype.decodeSingle=function(m,j,k){var n,l;m[0]=this.selector();for(l=0;l<this.nBlock[0];l+=1){n=this.getHuffmanValue(this.dcTab[0],j,k);if(n>=65280){return n}m[0]+=this.getn(m,n,j,k)}return 0};f.lossless.Decoder.prototype.getHuffmanValue=function(o,l,m){var n,k,j;j=65535;if(m[0]<8){l[0]<<=8;k=this.stream.get8();if(k===255){this.marker=this.stream.get8();if(this.marker!==0){this.markerIndex=9}}l[0]|=k}else{m[0]-=8}n=o[l[0]>>m[0]];if((n&f.lossless.Decoder.MSB)!==0){if(this.markerIndex!==0){this.markerIndex=0;return 65280|this.marker}l[0]&=(j>>(16-m[0]));l[0]<<=8;k=this.stream.get8();if(k===255){this.marker=this.stream.get8();if(this.marker!==0){this.markerIndex=9}}l[0]|=k;n=o[((n&255)*256)+(l[0]>>m[0])];m[0]+=8}m[0]+=8-(n>>8);if(m[0]<0){throw new Error("index="+m[0]+" temp="+l[0]+" code="+n+" in HuffmanValue()")}if(m[0]<this.markerIndex){this.markerIndex=0;return 65280|this.marker}l[0]&=(j>>(16-m[0]));return n&255};f.lossless.Decoder.prototype.getn=function(q,k,p,m){var s,l,j,r,o;l=1;j=-1;r=65535;if(k===0){return 0}if(k===16){if(q[0]>=0){return -32768}else{return 32768}}m[0]-=k;if(m[0]>=0){if((m[0]<this.markerIndex)&&!this.isLastPixel()){this.markerIndex=0;return(65280|this.marker)<<8}s=p[0]>>m[0];p[0]&=(r>>(16-m[0]))}else{p[0]<<=8;o=this.stream.get8();
if(o===255){this.marker=this.stream.get8();if(this.marker!==0){this.markerIndex=9}}p[0]|=o;m[0]+=8;if(m[0]<0){if(this.markerIndex!==0){this.markerIndex=0;return(65280|this.marker)<<8}p[0]<<=8;o=this.stream.get8();if(o===255){this.marker=this.stream.get8();if(this.marker!==0){this.markerIndex=9}}p[0]|=o;m[0]+=8}if(m[0]<0){throw new Error("index="+m[0]+" in getn()")}if(m[0]<this.markerIndex){this.markerIndex=0;return(65280|this.marker)<<8}s=p[0]>>m[0];p[0]&=(r>>(16-m[0]))}if(s<(l<<(k-1))){s+=(j<<k)+1}return s};f.lossless.Decoder.prototype.getPreviousX=function(j){if(this.xLoc>0){return this.getter((((this.yLoc*this.xDim)+this.xLoc)-1),j)}else{if(this.yLoc>0){return this.getPreviousY(j)}else{return(1<<(this.frame.precision-1))}}};f.lossless.Decoder.prototype.getPreviousXY=function(j){if((this.xLoc>0)&&(this.yLoc>0)){return this.getter(((((this.yLoc-1)*this.xDim)+this.xLoc)-1),j)}else{return this.getPreviousY(j)}};f.lossless.Decoder.prototype.getPreviousY=function(j){if(this.yLoc>0){return this.getter((((this.yLoc-1)*this.xDim)+this.xLoc),j)}else{return this.getPreviousX(j)}};f.lossless.Decoder.prototype.isLastPixel=function(){return(this.xLoc===(this.xDim-1))&&(this.yLoc===(this.yDim-1))};f.lossless.Decoder.prototype.outputSingle=function(j){if((this.xLoc<this.xDim)&&(this.yLoc<this.yDim)){this.setter((((this.yLoc*this.xDim)+this.xLoc)),j[0]);this.xLoc+=1;if(this.xLoc>=this.xDim){this.yLoc+=1;this.xLoc=0}}};f.lossless.Decoder.prototype.outputRGB=function(j){var k=((this.yLoc*this.xDim)+this.xLoc);if((this.xLoc<this.xDim)&&(this.yLoc<this.yDim)){this.setter(k,j[0],0);this.setter(k,j[1],1);this.setter(k,j[2],2);this.xLoc+=1;if(this.xLoc>=this.xDim){this.yLoc+=1;this.xLoc=0}}};f.lossless.Decoder.prototype.setValue16=function(j,k){this.outputData.setInt16(j*2,k,true)};f.lossless.Decoder.prototype.getValue16=function(j){return this.outputData.getInt16(j*2,true)};f.lossless.Decoder.prototype.setValue8=function(j,k){this.outputData.setInt8(j,k)};f.lossless.Decoder.prototype.getValue8=function(j){return this.outputData.getInt8(j)};f.lossless.Decoder.prototype.setValueRGB=function(k,l,j){this.outputData.setUint8(k*3+j,l)};f.lossless.Decoder.prototype.getValueRGB=function(k,j){return this.outputData.getUint8(k*3+j)};f.lossless.Decoder.prototype.readApp=function(){var k=0,j=this.stream.get16();k+=2;while(k<j){this.stream.get8();k+=1}return j};f.lossless.Decoder.prototype.readComment=function(){var l="",k=0,j;j=this.stream.get16();k+=2;while(k<j){l+=this.stream.get8();k+=1}return l};f.lossless.Decoder.prototype.readNumber=function(){var j=this.stream.get16();if(j!==4){throw new Error("ERROR: Define number format throw new IOException [Ld!=4]")}return this.stream.get16()};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.Decoder}},{"./data-stream.js":2,"./frame-header.js":4,"./huffman-table.js":5,"./quantization-table.js":7,"./scan-header.js":9,"./utils.js":10}],4:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.ComponentSpec=f.lossless.ComponentSpec||((typeof g!=="undefined")?g("./component-spec.js"):null);f.lossless.DataStream=f.lossless.DataStream||((typeof g!=="undefined")?g("./data-stream.js"):null);f.lossless.FrameHeader=f.lossless.FrameHeader||function(){this.components=[];this.dimX=0;this.dimY=0;this.numComp=0;this.precision=0};f.lossless.FrameHeader.prototype.read=function(n){var m=0,l,k,o,j;l=n.get16();m+=2;this.precision=n.get8();m+=1;this.dimY=n.get16();m+=2;this.dimX=n.get16();m+=2;this.numComp=n.get8();m+=1;for(k=1;k<=this.numComp;k+=1){if(m>l){throw new Error("ERROR: frame format error")}o=n.get8();m+=1;if(m>=l){throw new Error("ERROR: frame format error [c>=Lf]")}j=n.get8();m+=1;if(!this.components[o]){this.components[o]=new f.lossless.ComponentSpec()}this.components[o].hSamp=j>>4;this.components[o].vSamp=j&15;this.components[o].quantTableSel=n.get8();m+=1}if(m!==l){throw new Error("ERROR: frame format error [Lf!=count]")}return 1};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.FrameHeader}},{"./component-spec.js":1,"./data-stream.js":2}],5:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.DataStream=f.lossless.DataStream||((typeof g!=="undefined")?g("./data-stream.js"):null);f.lossless.Utils=f.lossless.Utils||((typeof g!=="undefined")?g("./utils.js"):null);f.lossless.HuffmanTable=f.lossless.HuffmanTable||function(){this.l=f.lossless.Utils.createArray(4,2,16);this.th=[];this.v=f.lossless.Utils.createArray(4,2,16,200);this.tc=f.lossless.Utils.createArray(4,2);this.tc[0][0]=0;this.tc[1][0]=0;this.tc[2][0]=0;this.tc[3][0]=0;this.tc[0][1]=0;this.tc[1][1]=0;this.tc[2][1]=0;this.tc[3][1]=0;this.th[0]=0;this.th[1]=0;this.th[2]=0;this.th[3]=0};f.lossless.HuffmanTable.MSB=2147483648;f.lossless.HuffmanTable.prototype.read=function(m,q){var o=0,k,r,s,p,n,l;k=m.get16();o+=2;while(o<k){r=m.get8();o+=1;s=r&15;if(s>3){throw new Error("ERROR: Huffman table ID > 3")}p=r>>4;if(p>2){throw new Error("ERROR: Huffman table [Table class > 2 ]")}this.th[s]=1;
this.tc[s][p]=1;for(n=0;n<16;n+=1){this.l[s][p][n]=m.get8();o+=1}for(n=0;n<16;n+=1){for(l=0;l<this.l[s][p][n];l+=1){if(o>k){throw new Error("ERROR: Huffman table format error [count>Lh]")}this.v[s][p][n][l]=m.get8();o+=1}}}if(o!==k){throw new Error("ERROR: Huffman table format error [count!=Lf]")}for(n=0;n<4;n+=1){for(l=0;l<2;l+=1){if(this.tc[n][l]!==0){this.buildHuffTable(q[n][l],this.l[n][l],this.v[n][l])}}}return 1};f.lossless.HuffmanTable.prototype.buildHuffTable=function(m,s,o){var u,t,p,r,q,l;t=256;p=0;for(r=0;r<8;r+=1){for(q=0;q<s[r];q+=1){for(l=0;l<(t>>(r+1));l+=1){m[p]=o[r][q]|((r+1)<<8);p+=1}}}for(r=1;p<256;r+=1,p+=1){m[p]=r|f.lossless.HuffmanTable.MSB}u=1;p=0;for(r=8;r<16;r+=1){for(q=0;q<s[r];q+=1){for(l=0;l<(t>>(r-7));l+=1){m[(u*256)+p]=o[r][q]|((r+1)<<8);p+=1}if(p>=256){if(p>256){throw new Error("ERROR: Huffman table error(1)!")}p=0;u+=1}}}};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.HuffmanTable}},{"./data-stream.js":2,"./utils.js":10}],6:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.ComponentSpec=f.lossless.ComponentSpec||((typeof g!=="undefined")?g("./component-spec.js"):null);f.lossless.DataStream=f.lossless.DataStream||((typeof g!=="undefined")?g("./data-stream.js"):null);f.lossless.Decoder=f.lossless.Decoder||((typeof g!=="undefined")?g("./decoder.js"):null);f.lossless.FrameHeader=f.lossless.FrameHeader||((typeof g!=="undefined")?g("./frame-header.js"):null);f.lossless.HuffmanTable=f.lossless.HuffmanTable||((typeof g!=="undefined")?g("./huffman-table.js"):null);f.lossless.QuantizationTable=f.lossless.QuantizationTable||((typeof g!=="undefined")?g("./quantization-table.js"):null);f.lossless.ScanComponent=f.lossless.ScanComponent||((typeof g!=="undefined")?g("./scan-component.js"):null);f.lossless.ScanHeader=f.lossless.ScanHeader||((typeof g!=="undefined")?g("./scan-header.js"):null);f.lossless.Utils=f.lossless.Utils||((typeof g!=="undefined")?g("./utils.js"):null);var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f}},{"./component-spec.js":1,"./data-stream.js":2,"./decoder.js":3,"./frame-header.js":4,"./huffman-table.js":5,"./quantization-table.js":7,"./scan-component.js":8,"./scan-header.js":9,"./utils.js":10}],7:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.DataStream=f.lossless.DataStream||((typeof g!=="undefined")?g("./data-stream.js"):null);f.lossless.Utils=f.lossless.Utils||((typeof g!=="undefined")?g("./utils.js"):null);f.lossless.QuantizationTable=f.lossless.QuantizationTable||function(){this.precision=[];this.tq=[];this.quantTables=f.lossless.Utils.createArray(4,64);this.tq[0]=0;this.tq[1]=0;this.tq[2]=0;this.tq[3]=0};f.lossless.QuantizationTable.enhanceQuantizationTable=function(l,k){var j;for(j=0;j<8;j+=1){l[k[(0*8)+j]]*=90;l[k[(4*8)+j]]*=90;l[k[(2*8)+j]]*=118;l[k[(6*8)+j]]*=49;l[k[(5*8)+j]]*=71;l[k[(1*8)+j]]*=126;l[k[(7*8)+j]]*=25;l[k[(3*8)+j]]*=106}for(j=0;j<8;j+=1){l[k[0+(8*j)]]*=90;l[k[4+(8*j)]]*=90;l[k[2+(8*j)]]*=118;l[k[6+(8*j)]]*=49;l[k[5+(8*j)]]*=71;l[k[1+(8*j)]]*=126;l[k[7+(8*j)]]*=25;l[k[3+(8*j)]]*=106}for(j=0;j<64;j+=1){l[j]>>=6}};f.lossless.QuantizationTable.prototype.read=function(p,o){var n=0,m,j,l,k;m=p.get16();n+=2;while(n<m){j=p.get8();n+=1;l=j&15;if(l>3){throw new Error("ERROR: Quantization table ID > 3")}this.precision[l]=j>>4;if(this.precision[l]===0){this.precision[l]=8}else{if(this.precision[l]===1){this.precision[l]=16}else{throw new Error("ERROR: Quantization table precision error")}}this.tq[l]=1;if(this.precision[l]===8){for(k=0;k<64;k+=1){if(n>m){throw new Error("ERROR: Quantization table format error")}this.quantTables[l][k]=p.get8();n+=1}f.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[l],o)}else{for(k=0;k<64;k+=1){if(n>m){throw new Error("ERROR: Quantization table format error")}this.quantTables[l][k]=p.get16();n+=2}f.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[l],o)}}if(n!==m){throw new Error("ERROR: Quantization table error [count!=Lq]")}return 1};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.QuantizationTable}},{"./data-stream.js":2,"./utils.js":10}],8:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.ScanComponent=f.lossless.ScanComponent||function(){this.acTabSel=0;this.dcTabSel=0;this.scanCompSel=0};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.ScanComponent}},{}],9:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.DataStream=f.lossless.DataStream||((typeof g!=="undefined")?g("./data-stream.js"):null);f.lossless.ScanComponent=f.lossless.ScanComponent||((typeof g!=="undefined")?g("./scan-component.js"):null);f.lossless.ScanHeader=f.lossless.ScanHeader||function(){this.ah=0;this.al=0;this.numComp=0;this.selection=0;this.spectralEnd=0;this.components=[]};f.lossless.ScanHeader.prototype.read=function(n){var m=0,l,k,j;l=n.get16();m+=2;this.numComp=n.get8();m+=1;for(k=0;k<this.numComp;k+=1){this.components[k]=new f.lossless.ScanComponent();if(m>l){throw new Error("ERROR: scan header format error")
}this.components[k].scanCompSel=n.get8();m+=1;j=n.get8();m+=1;this.components[k].dcTabSel=(j>>4);this.components[k].acTabSel=(j&15)}this.selection=n.get8();m+=1;this.spectralEnd=n.get8();m+=1;j=n.get8();this.ah=(j>>4);this.al=(j&15);m+=1;if(m!==l){throw new Error("ERROR: scan header format error [count!=Ns]")}return 1};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.ScanHeader}},{"./data-stream.js":2,"./scan-component.js":8}],10:[function(g,h,e){var f=f||{};f.lossless=f.lossless||{};f.lossless.Utils=f.lossless.Utils||{};f.lossless.Utils.createArray=function(m){var j=new Array(m||0),l=m;if(arguments.length>1){var k=Array.prototype.slice.call(arguments,1);while(l--){j[m-1-l]=f.lossless.Utils.createArray.apply(this,k)}}return j};var i=typeof h;if((i!=="undefined")&&h.exports){h.exports=f.lossless.Utils}},{}]},{},[6])(6)});(function(c,b,a){function d(j,g){var i=a.getPixelFormat(j);var l=j.elements.x7fe00010;var n=j.uint16("x00280010");var e=j.uint16("x00280011");var k=j.uint16("x00280002");var h=l.dataOffset;var f=e*n*k;var m=0;if(i===1){m=h+g*f;return new Uint8Array(j.byteArray.buffer,m,f)}else{if(i===2){m=h+g*f*2;return new Uint16Array(j.byteArray.buffer,m,f)}else{if(i===3){m=h+g*f*2;return new Int16Array(j.byteArray.buffer,m,f)}}}}a.extractUncompressedPixels=d}($,cornerstone,cornerstoneWADOImageLoader));(function(c,b,a){function d(i){var p=c.Deferred();var n=i.indexOf(":");var e=i.substring(n+1);var f=e.indexOf("frame=");var g;if(f!==-1){var k=e.substr(f+6);g=parseInt(k);e=e.substr(0,f-1)}if(g!==undefined&&a.internal.multiFrameCacheHack.hasOwnProperty(e)){var m=a.internal.multiFrameCacheHack[e];var o=a.createImageObject(m,i,g);o.then(function(q){p.resolve(q)},function(q){p.reject(q)});return p}var h=parseInt(e);var j=a.fileManager.get(h);if(j===undefined){p.reject("unknown file index "+e);return p}var l=new FileReader();l.onload=function(u){var r=u.target.result;var q=new Uint8Array(r);var t=dicomParser.parseDicom(q);if(g!==undefined){var t=a.internal.multiFrameCacheHack[e];var s=a.createImageObject(t,i,g);s.then(function(v){p.resolve(v)},function(v){p.reject(v)});return p}var s=a.createImageObject(t,i,g);s.then(function(v){p.resolve(v)},function(){p.reject()})};l.readAsArrayBuffer(j);return p}b.registerImageLoader("dicomfile",d)}($,cornerstone,cornerstoneWADOImageLoader));(function(d){var e=[];function f(g){var h=e.push(g);return"dicomfile:"+(h-1)}function c(g){return e[g]}function a(g){e[g]=undefined}function b(){e=[]}d.fileManager={add:f,get:c,remove:a,purge:b}}(cornerstoneWADOImageLoader));(function(b){function a(g){var e=65535;var c=-32768;var i=g.length;var f=g;for(var d=0;d<i;d++){var h=f[d];e=Math.min(e,h);c=Math.max(c,h)}return{min:e,max:c}}b.getMinMax=a}(cornerstoneWADOImageLoader));(function(b){function a(d){var c=d.uint16("x00280103");var e=d.uint16("x00280100");if(c===0&&e===8){return 1}else{if(c===0&&e===16){return 2}else{if(c===1&&e===16){return 3}}}}b.getPixelFormat=a}(cornerstoneWADOImageLoader));(function(b){function a(e){var c=e.string("x00280030");if(c&&c.length>0){var d=c.split("\\");return{row:parseFloat(d[0]),column:parseFloat(d[1])}}else{return{row:undefined,column:undefined}}}b.getPixelSpacing=a}(cornerstoneWADOImageLoader));(function(a){function b(d){var c={intercept:0,slope:1};if(d.elements.x00281052&&d.elements.x00281053){c.intercept=d.floatString("x00281052");c.slope=d.floatString("x00281053")}return c}a.getRescaleSlopeAndIntercept=b}(cornerstoneWADOImageLoader));(function(a){function b(d){var c={windowCenter:undefined,windowWidth:undefined};if(d.elements.x00281050&&d.elements.x00281051){c.windowCenter=d.floatString("x00281050");c.windowWidth=d.floatString("x00281051")}return c}a.getWindowWidthAndCenter=b}(cornerstoneWADOImageLoader));(function(d){var c={beforeSend:function(e){}};function b(e){c=e}function a(e){if(e==="RGB"||e==="PALETTE COLOR"||e==="YBR_FULL"||e==="YBR_FULL_422"||e==="YBR_PARTIAL_422"||e==="YBR_PARTIAL_420"||e==="YBR_RCT"||e==="YBR_ICT"){return true}else{return false}}d.isColorImage=a}(cornerstoneWADOImageLoader));(function(g,f,d){var c=document.createElement("canvas");var e="";function b(h,i){if(d.isJPEGBaseline8Bit(h)===true){return d.decodeJPEGBaseline8Bit(c,h,i)}var j=d.decodeTransferSyntax(h,i);return d.convertColorSpace(c,h,j)}function a(j,m,i){var o=d.getPixelSpacing(m);var u=m.uint16("x00280010");var k=m.uint16("x00280011");var n=d.getRescaleSlopeAndIntercept(m);var q=4;var h=u*k;var s=h*q;var r=d.getWindowWidthAndCenter(m);e=undefined;var t=g.Deferred();var p;try{p=b(m,i)}catch(l){t.reject(l);return t}p.then(function(z){function w(){return z.data}function x(){return z}function v(){if(e===j){return c}c.height=u;c.width=k;var A=c.getContext("2d");A.putImageData(z,0,0);e=j;return c}var y={imageId:j,minPixelValue:0,maxPixelValue:255,slope:n.slope,intercept:n.intercept,windowCenter:r.windowCenter,windowWidth:r.windowWidth,render:f.renderColorImage,getPixelData:w,getImageData:x,getCanvas:v,rows:u,columns:k,height:u,width:k,color:true,columnPixelSpacing:o.column,rowPixelSpacing:o.row,data:m,invert:false,sizeInBytes:s};
if(y.windowCenter===undefined){y.windowWidth=255;y.windowCenter=128}t.resolve(y)},function(v){t.reject(v)});return t}d.makeColorImage=a}($,cornerstone,cornerstoneWADOImageLoader));(function(f,d,c){function a(h){var g=c.getPixelFormat(h);if(g===1){return 1}else{if(g===2||g===3){return 2}}throw"unknown pixel format"}function b(o,j,g){var k=g.uint16("x00283002",0);if(k===0){k=65535}var h=0;if(j===0){h=g.uint16("x00283002",1)}else{h=g.int16("x00283002",1)}var n=g.uint16("x00283002",2);var m={id:"1",firstValueMapped:h,numBitsPerEntry:n,lut:[]};for(var l=0;l<k;l++){if(j===0){m.lut[l]=g.uint16("x00283006",l)}else{m.lut[l]=g.int16("x00283006",l)}}return m}function e(B,x,q){var C=f.Deferred();var k=c.getPixelSpacing(x);var n=x.uint16("x00280010");var h=x.uint16("x00280011");var m=c.getRescaleSlopeAndIntercept(x);var z;try{z=a(x)}catch(w){C.reject(w);return C}var A=n*h;var v=A*z;var y=x.string("x00280004");var p=(y==="MONOCHROME1");var g=c.getWindowWidthAndCenter(x);var l;try{l=c.decodeTransferSyntax(x,q)}catch(j){C.reject(j);return C}var t=c.getMinMax(l);function o(){return l}var s={imageId:B,minPixelValue:t.min,maxPixelValue:t.max,slope:m.slope,intercept:m.intercept,windowCenter:g.windowCenter,windowWidth:g.windowWidth,render:d.renderGrayscaleImage,getPixelData:o,rows:n,columns:h,height:n,width:h,color:false,columnPixelSpacing:k.column,rowPixelSpacing:k.row,data:x,invert:p,sizeInBytes:v};var r=x.uint16("x00280103");if(x.elements.x00283000){s.modalityLUT=b(s,r,x.elements.x00283000.items[0].dataSet)}if(x.elements.x00283010){r=0;if(s.minPixelValue*s.slope+s.intercept<0){r=1}s.voiLUT=b(s,r,x.elements.x00283010.items[0].dataSet)}if(s.windowCenter===undefined){var i=s.maxPixelValue*s.slope+s.intercept;var u=s.minPixelValue*s.slope+s.intercept;s.windowWidth=i-u;s.windowCenter=(i+u)/2}C.resolve(s);return C}c.makeGrayscaleImage=e}($,cornerstone,cornerstoneWADOImageLoader));(function(a){a.version="0.7.2"}(cornerstoneWADOImageLoader));(function(c){function a(g,j,e){if(e+g.length>j.length){return false}var h=e;for(var f=0;f<g.length;f++){if(g[f]!==j[h++]){if(h>520000){console.log("token=",uint8ArrayToString(g));console.log("data=",uint8ArrayToString(j,e,h-e));console.log("miss at %d %s dataOffset=%d",f,String.fromCharCode(j[h]),h);console.log("miss at %d %s dataOffset=%d",f,String.fromCharCode(g[h]),h)}return false}}return true}function d(h){var f=new Uint8Array(h.length);for(var g=0,e=h.length;g<e;g++){f[g]=h.charCodeAt(g)}return f}function b(g,j,h){h=h||0;var f=d(j);for(var e=h;e<g.length;e++){if(f[0]===g[e]){if(a(f,g,e)){return e}}}return -1}c.internal.findIndexOfString=b}(cornerstoneWADOImageLoader));(function(c){function d(f){for(var e=0;e<f.length;e++){if(f[e].substr(0,2)==="--"){return f[e]}}return undefined}function b(f){for(var e=0;e<f.length;e++){if(f[e].substr(0,13)==="Content-Type:"){return f[e].substr(13).trim()}}return undefined}function a(g,j,f){j=j||0;f=f||g.length-j;var h="";for(var e=j;e<j+f;e++){h+=String.fromCharCode(g[e])}return h}c.internal.getImageFrame=function(g,e){e=e||"application/octet-stream";var f=$.Deferred();var h=new XMLHttpRequest();h.responseType="arraybuffer";h.open("get",g,true);h.setRequestHeader("Accept","multipart/related;type="+e);h.onreadystatechange=function(r){if(h.readyState===4){if(h.status===200){var p=h.response;var k=new Uint8Array(h.response);var o=c.internal.findIndexOfString(k,"\n\r\n");if(o===-1){f.reject("invalid response - no multipart mime header")}var n=a(k,0,o);var q=n.split("\r\n");var j=d(q);if(!j){f.reject("invalid response - no boundary marker")}var l=o+4;var m=c.internal.findIndexOfString(k,j,l);if(m===-1){f.reject("invalid response - terminating boundary not found")}var i=m-l-1;f.resolve({contentType:b(q),arrayBuffer:p,offset:l,length:i})}else{f.reject(h.response)}}};h.send();return f}}(cornerstoneWADOImageLoader));(function(e){var b=[];function f(h){var g=b.push(h);return"wadors:"+(g-1)}function d(g){return b[g]}function a(g){b[g]=undefined}function c(){b=[]}e.imageManager={add:f,get:d,remove:a,purge:c}}(cornerstoneWADOImageLoader));(function(c,b,a){function d(h){var f=c.Deferred();var g=h.substring(7);var i=a.imageManager.get(g);if(i===undefined){f.reject("unknown imageId");return f}var e;a.internal.getImageFrame(i.uri,e).then(function(j){console.log(j);var l;if(i.instance.bitsAllocated===16){if(i.instance.pixelRepresentation===0){l=new Uint16Array(j.arrayBuffer,j.offset,j.length/2)}else{l=new Int16Array(j.arrayBuffer,j.offset,j.length/2)}}else{if(i.instance.bitsAllocated===8){l=new Uint8Array(j.arrayBuffer,j.offset,j.length)}}var k=a.getMinMax(l);i.imageId=h;i.minPixelValue=k.min;i.maxPixelValue=k.max;i.render=b.renderGrayscaleImage;i.getPixelData=function(){return l};f.resolve(i)}).fail(function(j){f.reject(j)});return f}b.registerImageLoader("wadors",d)}($,cornerstone,cornerstoneWADOImageLoader));(function(c,b,a){function d(h){var k=h.indexOf(":");var e=h.substring(k+1);var f=e.indexOf("frame=");var g;if(f!==-1){var i=e.substr(f+6);g=parseInt(i);e=e.substr(0,f-1)
}if(g!==undefined&&a.internal.multiFrameCacheHack.hasOwnProperty(e)){var m=c.Deferred();var j=a.internal.multiFrameCacheHack[e];var l=a.createImageObject(j,h,g);l.then(function(n){m.resolve(n)},function(n){m.reject(n)});return m}return a.internal.xhrRequest(h,g,e)}b.registerImageLoader("dicomweb",d);b.registerImageLoader("wadouri",d)}($,cornerstone,cornerstoneWADOImageLoader));(function(c,b,a){function d(g,i,f){var e=c.Deferred();var h=new XMLHttpRequest();h.open("get",f,true);h.responseType="arraybuffer";a.internal.options.beforeSend(h);h.onreadystatechange=function(k){if(h.readyState===4){if(h.status===200){var l=h.response;var j=new Uint8Array(l);var n=dicomParser.parseDicom(j);if(i!==undefined){a.internal.multiFrameCacheHack[f]=n}var m=a.createImageObject(n,g,i);m.then(function(o){e.resolve(o)},function(o){e.reject(o)})}else{e.reject(h.response)}}};h.onprogress=function(m){if(m.lengthComputable){var j=m.loaded;var l=m.total;var k=Math.round((j/l)*100);c(b).trigger("CornerstoneImageLoadProgress",{imageId:g,loaded:j,total:l,percentComplete:k})}};h.send();return e}a.internal.xhrRequest=d}($,cornerstone,cornerstoneWADOImageLoader));