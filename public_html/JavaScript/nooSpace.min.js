$(function(){if($("#noospace").length!=0){var t=$("#overlayGestionnaireDonnees"),e=0,j=[],w=[],g=[],f=[],u=[],q=[];dataManagerAlreadyOpened=false;addDataAlreadyLoaded=false;$.ajax({url:"/NooSpace/getSession",type:"POST",async:true,cache:false,contentType:false,processData:false,success:function(x){try{x=JSON.parse(x);sessionStorage.setItem("id",x.id);sessionStorage.setItem("isAdmin",x.isAdmin)}catch(y){var x={erreurs:"<p>A system error has occurred while getting your user session.</p>"};displayInformationsClient(x)}},error:function(){var x={erreurs:"<p>A system error has occurred while getting your user session.</p>"};displayInformationsClient(x)}});$("#boutonShowGestionnaireDonnees").on("click",openGestionnaireDonnees);$("#laMule").hide();if($("#noospace .runIt").length!=0){var a=parseInt($("#noospace").css("width"));$("#noospace").css("width",a-50+"px");var c=$("#noospace .runIt");o(c,$("#noospace"));c.remove()}$("#noospace").droppable({drop:function(z,G){var F=$(this).offset();var B=z.clientX,A=z.clientY,J=G.draggable.offset(),E=B-J.left,D=A-J.top,y=B-F.left-E,x=A-F.top-D,I=parseInt(t.css("width")),H=t.offset().top+parseInt(t.css("height"));if(G.draggable.parent().attr("id")==="applicationsInDock"||G.draggable.hasClass("runIt")){o(G.draggable,$(this),y,x)}else{if(G.draggable.parent().attr("id")==="inListeDonneesUser"&&(B>I||A>H)){var C=false;$("#noospace .dataBox").each(function(K){var L=$(this).offset();if(B>=L.left&&B<=L.left+64&&A>=L.top&&A<=L.top+64){C=true}});if(!C){v(G.draggable.clone(),$(this),B-F.left-34,A-F.top-34)}}else{if(G.draggable.parent().hasClass("dataBox")){$(this).append(G.draggable);G.draggable.css("position","absolute").css("top",x+"px").css("left",y+"px")}else{if(G.draggable.hasClass("newTempData")){G.draggable.removeClass("newTempData");v(G.draggable,$(this),y,x)}}}}}});function o(B,E,y,x){var z,F,C;if(B.hasClass("runIt")){B.removeClass("runIt")}if(typeof y=="undefined"||typeof x=="undefined"){var D=parseInt($("#noospace").width()),H=parseInt($("#noospace").height());y=parseInt(D/2);x=parseInt(H/3)}var G=B.clone();G.appendTo(E);G.attr("numApp",e);e+=1;G.css("width","auto").css("position","absolute").css("top",x+"px").css("left",y-93+"px");G.draggable({revert:false,containment:"#noospace",start:function(){$(this).find(".containerApplication").children("img").addClass("noClick")}});G.find(".imageApplication").animate({width:64,height:64},1500);G.find(".containerApplication").children("hr").show("slice").css("display","inline-block");setTimeout(function(){G.find(".containerApplication").children(".resultBox").show("slice").css("display","inline-block");G.find(".linkPlay").show("slice").css("visibility","visible").css("display","block");G.find(".playButton").show("slice").css("visibility","visible").css("display","block")},500);G.children(".dataBox").droppable({accept:".donneeUser",drop:function(K,L){var I=K.clientX,J=parseInt($("#overlayGestionnaireDonnees").css("width"));if(I>J){v(L.draggable.clone(),$(this),2,2);if(L.draggable.parent().attr("id")!="inListeDonneesUser"){L.draggable.remove()}}}});var A=new FormData();A.append("idApplication",G.attr("id"));$.ajax({url:"/NooSpace/InfoApplication",type:"POST",async:true,cache:false,data:A,contentType:false,processData:false,success:function(I){try{I=JSON.parse(I);C=I.listeTypeDonnee;F=I.listeTache;z=I.listeParams}catch(J){var I={erreurs:"<p>A system error has occurred.</p>"};displayInformationsClient(I)}},error:function(){var I={erreurs:"<p>A system error has occurred.</p>"};displayInformationsClient(I)}});setTimeout(function(){var L=G.find(".tachesApplication");parametres=[],currentTache="";s(G,C,C[0]["nomTache"]);parametres=b(z);for(var J=0;J<C.length;++J){var I=C[J]["nomTache"];if(I!=currentTache){L.append('<form name="'+I+'"></form>');currentTache=I;if(typeof parametres[I]!="undefined"){for(var K=0;K<parametres[I].length;++K){L.find($("form[name='"+I+"']")).append("<input type='text' id='"+parametres[I][K]["nomParams"]+"' name='"+parametres[I][K]["idParams"]+"' class='inputVariable valeurDefautParametre' value='"+parametres[I][K]["defaultVal"]+"' readonly />")}}}}G.find($("form[name='"+C[0]["nomTache"]+"'")).addClass("activated")},800);G.find(".playButton").click(function(){try{G.find(".containerApplication").children(".ajaxLoaderApplication").css("visibility","visible").css("display","block");var J=G.find(".tachesApplication form").serializeArray(),I=G.find(".tachesApplication").find(".activated").attr("name"),P=p(C),O=new FormData(),N=P[I].length;for(var L=0;L<N;++L){if(P[I][L]["ext"]!="input.txt"){O.append("tache0data"+L,"noolibData_"+G.children(".allDataBox").find(".dataBox:eq("+(L)+")").find(".donneeUser").attr("id"))}else{O.append("tache0data"+(L),G.children(".allDataBox").find(".dataBox:eq("+(L)+")").val())}}O.append("idApplication",G.attr("id"));O.append("idVersion",G.attr("idVersion"));O.append("tache0",I);for(var L=0;L<J.length;L++){O.append(J[L].name,J[L].value)}d(O,G)}catch(M){var K={erreurs:"<p>A system error has occurred.</p>"};
displayInformationsClient(K);G.children(".ajaxLoaderApplication").css("visibility","hidden").css("display","none");G.find(".resultBox img").hide(600);G.find(".applicationReports").html("")}});G.contextMenu({selector:".imageApplication",callback:function(O,Q){if(O==="delete"){$(this).parent().parent().parent().remove();var I=G.attr("numApp");j[I]=[];w[I]=[];g[I]=[];q[I]=[]}if(O==="mule"){var J=new FormData();J.append("idApplication",G.attr("id"));$.ajax({url:"/HandleApplication/ShowMule",type:"POST",async:true,cache:false,data:J,contentType:false,processData:false,success:function(U){try{U=JSON.parse(U);var R=parseInt($("#overlayGestionnaireDonnees").css("width")),Y=parseInt($("#boutonShowGestionnaireDonnees").css("left")),T=1200;var V=$("#formMule").find(".task:first");V.find(".form-group").empty();$("#formMule").find(".task").remove();$("#formMule").find("button").remove();V.prependTo($("#formMule"));if(U.erreurs){displayInformationsClient(U);if(R>500){$("#overlayGestionnaireDonnees").animate({width:R-400},1500);$("#boutonShowGestionnaireDonnees").animate({left:Y-400},1500);$("#laMule").hide()}}else{if(R>500){$("#overlayGestionnaireDonnees").animate({width:R-400},1000).animate({width:R},1500);$("#boutonShowGestionnaireDonnees").animate({left:Y-400},1000).animate({left:Y},1500);$("#laMule").hide();T=T+1000}else{$("#overlayGestionnaireDonnees").animate({width:R+400},1500);$("#boutonShowGestionnaireDonnees").animate({left:Y+400},1500);if(!dataManagerAlreadyOpened){setTimeout(function(){openGestionnaireDonnees()},T+300)}}setTimeout(function(){$("#laMule").fadeIn()},T);$("#laMule").find(".titreGestionnaire").html("Mule of "+U.nomApplication);var S=U.listeTypeDonnee,X=U.listeTypeDonnee[0]["nomTache"];$("#formMule").find(".form-group:first").append(U.listeTache);l(X,S);$('<button type="submit" data-loading-text="<span class=\'glyphicon glyphicon-refresh spinning\'></span> Running..." class="btn btn-default pull-right">Go forward</button>').insertAfter(".task:last");$('<button class="btn btn-default pull-left" disabled>&ndash;</button>').insertAfter(".task:last");$('<button class="btn btn-default pull-left">+</button>').insertAfter(".task:last");$("#formMule").find(".listeTache").change(function(){l($(this).val(),S,$(this).parent().next())});h(X,S);$("#formMule").find("button:last").click(function(ad){ad.preventDefault();$(this).button("loading");var ab=document.querySelector("#formMule"),Z=G.find(".tachesApplication form").serializeArray(),ac=new FormData(ab);for(var aa=0;aa<Z.length;aa++){ac.append(Z[aa].name,Z[aa].value)}ac.append("idApplication",G.attr("id"));ac.append("idVersion",G.attr("idVersion"));d(ac,G)})}}catch(W){var U={erreurs:"<p>A system error has occurred.</p>"};displayInformationsClient(U);var R=parseInt($("#overlayGestionnaireDonnees").css("width")),Y=parseInt($("#boutonShowGestionnaireDonnees").css("left"));if(R>500){$("#overlayGestionnaireDonnees").animate({width:R-400},1500);$("#boutonShowGestionnaireDonnees").animate({left:Y-400},1500);$("#laMule").hide();$("#formMule").find(".form-group").empty()}}},error:function(){var R={erreurs:"<p>A system error has occurred.</p>"};displayInformationsClient(R)}})}if(O==="parametreApplication"){var L=$("#panelSettingsApplication"),N=L.find(".modal-body"),K=L.find("#tacheSelect"),M=G.find(".tachesApplication"),P=M.find(".activated").attr("name");K.html(F);K.find("select").val(P);n(G,P,z);L.modal("show");K.find("select").change(function(){M.find("form").removeClass("activated");G.find($("form[name='"+$(this).val()+"'")).addClass("activated");n(G,$(this).val(),z);m(G,C,$(this).val());G.find(".surContainer").remove();G.find(".allDataBox").each(function(){G.children("hr").remove();$(this).remove()});s(G,C,K.find("select").val());sliderParametreApplication(N)});sliderParametreApplication(N);m(G,C,P)}},autoHide:true,items:{parametreApplication:{name:"Set it"},mule:{name:"Call the mule"},sep1:"---------","delete":{name:"Remove from the NooSpace",icon:"delete"}}})}function v(y,x,A,z){y.children("img").on({click:function(){if($(this).hasClass("noClick")){$(this).removeClass("noClick")}else{forShowingData(y)}}});y.appendTo(x);if(x.attr("id")=="noospace"){y.css("position","absolute").css("top",z+"px").css("left",A+"px")}else{y.css("top",z+"px").css("left",A+"px")}y.popover({placement:"right",trigger:"hover"});y.contextMenu({selector:"img",callback:function(C,B){if(C==="delete"){$(this).parent().remove()}},autoHide:true,items:{"delete":{name:"Remove from the NooSpace",icon:"delete"}}});y.draggable({revert:false,containment:"#noospace",snap:".dataBox",appendTo:"#noospace",helper:"clone",start:function(B,C){$(this).hide();$(this).children("img").addClass("noClick")},drag:function(B,C){$(this).popover("hide")},stop:function(B,C){if($(this).parent().attr("id")==="noospace"){$(this).css({top:$(C.helper).position().top,left:$(C.helper).position().left})}$(this).show()}})}function r(){$("#formMule").find(".dashedBorder").droppable({drop:function(z,A){if($(this).is(":empty")){var y=A.draggable.clone();
$(this).append(y);$(this).next().next().attr("value","noolibData_"+y.attr("id"));y.contextMenu({selector:"img",callback:function(C,B){if(C==="delete"){$(this).parent().parent().next().attr("value","");$(this).parent().remove()}},autoHide:true,items:{"delete":{name:"Unload the mule",icon:"delete"}}})}else{var x={erreurs:"<p>Unload the mule firstly.</p>"};displayInformationsClient(x)}}})}$("#resultReportApplication").on("hidden.bs.modal",function(){var y=parseInt($("#resultReportApplication").attr("numApp")),x;$(".appInDock").each(function(){if(parseInt($(this).attr("numApp"))==y){x=$(this)}});$("#resultReportApplication").find(".applicationReports").addClass("hidden");$("#resultReportApplication").find(".applicationReports").appendTo(x.find(".resultBox"));$("#carouselApplicationReport").empty()});function d(y,x){y.append("id",sessionStorage.id);y.append("isAdmin",sessionStorage.isAdmin);var z=window.location.hostname==="www.noolib.com"?"https://node.noolib.com/runTheMule/":"http://"+window.location.hostname+":3000/runTheMule/";$.ajax({url:z,type:"POST",async:true,cache:false,data:y,contentType:false,processData:false,success:function(F){var W=x.attr("numApp");$("#formMule").find("button:last").button("reset");x.find(".containerApplication").children(".ajaxLoaderApplication").css("visibility","hidden").css("display","none");x.find(".resultBox img").hide(600);x.find(".applicationReports").empty();j[W]=[];w[W]=[];g[W]=[];q[W]=[];try{F=JSON.parse(F)}catch(an){var F={erreurs:"<p>A system error has occurred while running the application.</p>"};displayInformationsClient(F)}if(F.resultat){var aq={reussites:"<p>A new application report has been released.</p>",erreurs:F.erreurs};displayInformationsClient(aq);x.find(".resultBox img").show(600);var ad=$("#templateItemReportApplication"),Y=0,H=0,B=0;for(var ai=0,P=F.resultat.length;ai<P;++ai){try{var ao=JSON.parse(F.resultat[ai])}catch(an){var X=F.resultat[ai];F={erreurs:"<p>A fatal system error has occured. Please take a look at the report.</p>"},ao=[];displayInformationsClient(F);ao.systemError=X}finally{var U=ad.clone(),Q=Math.floor(Math.random()*100);U.removeAttr("id");U.removeClass("hidden");var ag=U.find("a"),C=U.find(".tab-pane"),N=U.find(".nav"),K=U.find(".tab-content");ag[0].href="#table2D"+W+Q;ag[1].href="#results"+W+Q;ag[2].href="#comments"+W+Q;ag[3].href="#errors"+W+Q;C[0].id="table2D"+W+Q;C[1].id="results"+W+Q;C[2].id="comments"+W+Q;C[3].id="errors"+W+Q;if(ao.table){U.find(".table2D").remove();$(ag[0]).parent().remove()}else{U.find(".table2D").remove();$(ag[0]).parent().remove()}if(ao.images){var D=ao.images;for(var al=0,ah=D.length;al<ah;++al){var E=new Image(),J=Math.floor(Math.random()*100);E.src="data:image/"+D[al]["ext"]+";base64,"+D[al]["data"];N.append('<li><a href="#image'+W+J+'" data-toggle="tab">'+D[al]["name"]+"."+D[al]["ext"]+"</a></li>");K.append('<div class="tab-pane results imageResult text-center" index-image="'+Y+'" id="image'+W+J+'"></div>');K.find("#image"+W+J).append(E);j[W].push({ext:D[al]["ext"],name:D[al]["name"],rawData:D[al]["data"],dataJson:"data:image/"+D[al]["ext"]+";base64,"+D[al]["data"],data:"data:image/"+D[al]["ext"]+";base64,"+D[al]["data"],sample:1,min:1,size:1});Y+=1}}if(ao.graphs){var ab=ao.graphs;for(var al=0,M=ab.length;al<M;++al){var aj=new TXTFile(),O=15000,ak=Math.floor(Math.random()*100);if(typeof(ab[al]["legend"])!=="undefined"&&typeof(ab[al]["data"])!=="undefined"&&typeof(ab[al]["sampleRate"])!=="undefined"){aj.construct_from_data(ab[al]["legend"],ab[al]["data"],O,ab[al]["sampleRate"]);N.append('<li><a href="#graph'+W+ak+'" data-toggle="tab">'+ab[al]["name"]+"</a></li>");K.append('<div class="tab-pane centering" id="graph'+W+ak+'"><div class="graphResult"></div><div class="tableResult table-responsive tableOfGraph"><table class="table table-bordered table-striped table-condensed"></table></div></div>');var V=K.find("#graph"+W+ak);tableData(aj,V);V.find(".tableOfGraph").attr("index-graph",H);w[W].push({ext:"csv",name:ab[al]["name"],rawData:ab[al]["data"],legend:aj.get_legend(),data:aj,sample:aj.get_sample_rate(),min:1,lengthData:aj.get_size_signals(),size:aj.get_number_of_signals(),index:H});H+=1}else{var aq={erreurs:"<p>Legend, array of data or sample rate is missing for displaying the data.</p>"};displayInformationsClient(aq)}}}if(ao.results){var R=U.find(".tableOfResults");R.append('<div class="text-center jaugeResult"></div><div class="text-center tabResult"></div>');var G=R.find(".tabResult"),S=R.find(".jaugeResult");for(var al=0,am=ao.results.length;al<am;++al){if(ao.results[al]["min"]&&ao.results[al]["max"]){S.append('<div class="jauge" index-jauge='+B+"></div>");g[W].push({name:ao.results[al]["name"],value:ao.results[al]["value"],min:ao.results[al]["min"],max:ao.results[al]["max"],thresholdMin:ao.results[al]["thresholdMin"],thresholdMax:ao.results[al]["thresholdMax"],unit:ao.results[al]["unit"],index:B});B+=1}else{G.append('<table class="table table-inverse"><thead class="thead-inverse"><tr><th>'+ao.results[al]["name"]+"</th></tr></thead><tbody><tr><td>"+ao.results[al]["value"]+"</td></tr></tbody></table>")
}}}else{U.find(".tableOfResults").remove();$(ag[1]).parent().remove()}if(ao.comments){for(var al=0,A=ao.comments.length;al<A;++al){U.find(".commentsResult").append('<li class="list-group-item"><h4>'+ao.comments[al]["name"]+"</h4><p>"+ao.comments[al]["content"]+"</p></li>")}}else{U.find(".commentsResult").remove();$(ag[2]).parent().remove()}if(ao.files){for(var al=0,ae=ao.files.length;al<ae;++al){var aa=Math.floor(Math.random()*100),T=ao.files[al]["name"],ap=ao.files[al]["ext"].toLowerCase();N.append('<li><a href="#file'+W+aa+'" data-toggle="tab">'+T+"."+ap+"</a></li>");K.append('<div class="tab-pane results editor" id="file'+W+aa+'"></div>');q[W].push({ext:"xml",name:T,dataJson:ao.files[al]["data"],id:"file"+W+aa,sample:1,min:1,size:1})}setTimeout(function(){for(var at=0,av=q[W].length;at<av;++at){var au=ace.edit(q[W][at]["id"]),ar=base64_decode(q[W][at]["dataJson"]);au.$blockScrolling=Infinity;au.setHighlightActiveLine(true);au.setValue(ar,1);au.setTheme("ace/theme/monokai");au.getSession().setMode("ace/mode/"+q[W][at]["ext"])}},500)}if(ao.errors||ao.systemError||ao.erreurs){if(ao.errors){for(var al=0,ac=ao.errors.length;al<ac;++al){U.find(".errorsResult").append('<li class="list-group-item list-group-item-danger"><h4>'+ao.errors[al]["name"]+"</h4><p>"+ao.errors[al]["content"]+"</p></li>")}}if(ao.systemError){U.find(".errorsResult").append('<li class="list-group-item list-group-item-danger"><h4>System error</h4><p>'+ao.systemError+"</p></li>")}if(ao.erreurs){U.find(".errorsResult").append('<li class="list-group-item list-group-item-danger"><h4>System error</h4><p>'+ao.erreurs+"</p></li>")}}else{U.find(".errorsResult").remove();$(ag[3]).parent().remove()}U.find("li:first").addClass("active");U.find(".tab-pane:first").addClass("active");U.appendTo(x.find(".applicationReports"));for(var af=0;af<w[W].length;++af){var Z=w[W][af]["index"],L=x.find('[index-graph="'+Z+'"]')[0];graphLocalData(w[W][af]["data"],15000,$(L).parent())}for(var af=0;af<g[W].length;++af){var Z=g[W][af]["index"],L=x.find('[index-jauge="'+Z+'"]')[0];if(g[W][af]["thresholdMin"]&&g[W][af]["thresholdMax"]){var I={yAxis:{stops:[[0,"#55BF3B"],[parseFloat(g[W][af]["thresholdMin"])/parseFloat(g[W][af]["max"]),"#DDDF0D"],[parseFloat(g[W][af]["thresholdMax"])/parseFloat(g[W][af]["max"]),"#DF5353"]],lineWidth:0,minorTickInterval:null,tickAmount:2,min:parseFloat(g[W][af]["min"]),max:parseFloat(g[W][af]["max"])}}}else{var I={yAxis:{lineWidth:0,minorTickInterval:null,tickAmount:2,min:parseFloat(g[W][af]["min"]),max:parseFloat(g[W][af]["max"])}}}$(L).highcharts(Highcharts.merge(I,{chart:{type:"solidgauge"},title:{text:g[W][af]["name"]},pane:{center:["50%","50%"],size:"100%",startAngle:-90,endAngle:90,background:{backgroundColor:(Highcharts.theme&&Highcharts.theme.background2)||"#EEE",innerRadius:"60%",outerRadius:"100%",shape:"arc"}},tooltip:{enabled:false},exporting:{enabled:false},plotOptions:{solidgauge:{dataLabels:{y:5,borderWidth:0,useHTML:true}}},credits:{enabled:false},series:[{name:g[W][af]["name"],data:[parseFloat(g[W][af]["value"])],dataLabels:{format:'<div style="text-align:center"><span style="font-size:25px;color:'+((Highcharts.theme&&Highcharts.theme.contrastTextColor)||"black")+'">{y}</span><br/><span style="font-size:12px;color:silver">'+g[W][af]["unit"]+"</span></div>"},tooltip:{valueSuffix:g[W][af]["unit"]}}]}))}}}x.find(".imageResult").click(function(ax){if(j[W].length!=0){var aw=$(ax.target);if(!aw.hasClass("imageResult")){aw=aw.parent()}try{var au=parseInt(aw.attr("index-image")),at=base64toBlob(j[W][au]["rawData"],"image/png"),ay=Math.floor(Math.random()*1000+1),az="Picture_generated_by_NooLib_"+ay+".png";saveAs(at,az)}catch(av){var ar={erreurs:"<p>A system error has occurred. No image found.</p>"};displayInformationsClient(ar)}}});x.find(".tableOfGraph").click(function(at){if(w[W].length!=0){var au=$(at.target);while(!au.hasClass("tableOfGraph")&&au[0].nodeName!="body"){au=au.parent()}try{var az=parseInt(au.attr("index-graph")),ay=tableToCSV(w[W][az]["legend"],w[W][az]["rawData"]),ar=new Blob([ay],{type:"text/csv;charset=utf-8"}),aA=Math.floor(Math.random()*1000+1),ax="Table_generated_by_NooLib_"+aA+".csv";saveAs(ar,ax)}catch(aw){var av={erreurs:"<p>A system error has occurred. No table found.</p>"};displayInformationsClient(av)}}});x.find(".resultBox img").click(function(){$("#resultReportApplication").modal();$("#resultReportApplication").attr("numApp",x.attr("numApp"));x.find(".applicationReports").removeClass("hidden");x.find(".applicationReports").appendTo($("#carouselApplicationReport"))})}else{if(F.erreurs){displayInformationsClient(F)}else{var F={erreurs:"<p>A system error has occurred while running the application.</p>"};displayInformationsClient(F)}}},error:function(){$("#formMule").find("button:last").button("reset");var A={erreurs:"<p>Too many requests have been sent or an unknown error has occurred. Please try again in a few minutes or change your data.</p>"};displayInformationsClient(A);x.find(".containerApplication").children(".ajaxLoaderApplication").css("visibility","hidden").css("display","none");
x.find(".resultBox img").hide(600);x.find(".applicationReports").html("")}})}$("#formSaveResult").on("submit",function(F){F.preventDefault();var A=parseInt($("#resultReportApplication").attr("numApp"));try{for(var C=0,J=j[A].length;C<J;++C){k(j[A][C])}for(var C=0,I=q[A].length;C<I;++C){k(q[A][C])}for(var C=0,K=w[A].length;C<K;++C){var B=[],G=[];G[0]="Time";for(var y=0,H=w[A][C].legend.length;y<H;++y){G[y+1]=w[A][C].legend[y]}B.push(G);for(var z=0;z<w[A][C].lengthData;++z){G=[];G[0]=z/(w[A][C].sample);for(var y=0,D=w[A][C].size;y<D;++y){G[y+1]=w[A][C].rawData[y][z]}B.push(G)}var E=JSON.stringify(B);E=E.replace("\\r","");w[A][C].dataJson=E;k(w[A][C])}}catch(F){var x={erreurs:"<p>A system error has occurred: "+F+"</p>"};displayInformationsClient(x)}});function k(x){var y=new FormData();y.append("ext",x.ext);y.append("nomFichier",x.name);y.append("donneeUtilisateur",x.dataJson);y.append("sampleRateDonneeUtilisateur",x.sample);y.append("tailleDonneeUtilisateur",x.size);y.append("tempsMinimumDonneeUtilisateur",x.min);$("#image-result-waiter").show();$("#labelSubmitSaveResult").attr("for","");$("#labelSubmitSaveResult img").css("opacity","0.2").css("cursor","default").attr("data-content","");$.ajax({url:"/HandleData/AddLocalData",type:"POST",data:y,async:true,cache:false,contentType:false,processData:false,success:function(z){try{var z=JSON.parse(z)}catch(B){var z={erreurs:"<p>A system error has occurred: "+B+"</p>"};displayInformationsClient(z)}if(z.reussites){displayInformationsClient(z);$("#inListeDonneesUser").html(z.listeDonneeUtilisateur);var A={tailleMoDonneesUtilisateur:z.tailleMoDonneesUtilisateur,tailleMaxDonneesUtilisateur:z.tailleMaxDonneesUtilisateur,progressionPourcent:z.progressionPourcent};showData(A)}else{if(z.erreurs){displayInformationsClient(z)}}$("#image-result-waiter").hide();$("#labelSubmitSaveResult").attr("for","submitSaveResult");$("#labelSubmitSaveResult img").css("opacity","1").css("cursor","pointer").attr("data-content","Load all results in your data manager")},error:function(C,A,B){var z={erreurs:"<p>The size of data exceeds the limit authorized.</p><p>Please try again with another data.</p>"};displayInformationsClient(z);$("#image-result-waiter").hide();$("#labelSubmitSaveResult").attr("for","submitSaveResult");$("#labelSubmitSaveResult img").css("opacity","1").css("cursor","pointer").attr("data-content","Load all results in your data manager")}})}function l(x,z,D){if(typeof D==="undefined"){var D=$("#formMule").find(".form-group:last")}var C=0,y=D.parent().find(".form-group:first select").attr("name");D.html("");for(var A=0,E=z.length;A<E;++A){if(z[A]["nomTache"]===x){if(z[A]["ext"]==="input.txt"){var B='<input type="txt" name="'+y+"data"+C+'" class="donneeUser dashedBorder input-sm" value="" placeholder="'+z[A]["description"]+'" data-html="true" data-toggle="popover" data-content="'+z[A]["description"]+'" title="'+z[A]["nomTypeDonnee"]+'"/>'}else{if(z[A]["ext"]==="input.bool"){var B='<div class="checkbox_wrapper donneeUser" placeholder="'+z[A]["description"]+'" data-html="true" data-toggle="popover" data-content="'+z[A]["description"]+'" title="'+z[A]["nomTypeDonnee"]+'">';B+='<input type="hidden" name="'+y+"data"+C+'" value="0"/>';B+='<input type="checkbox" name="'+y+"data"+C+'" value="1"/>';B+="<label></label></div>"}else{var B='<div class="donneeUser dashedBorder" data-html="true" data-toggle="popover" data-content="<span class=\'badge\'>'+z[A]["ext"]+"</span> "+z[A]["description"]+'" title="'+z[A]["nomTypeDonnee"]+'"></div>';B+='<input type="hidden" class="inputData" name="'+y+"data"+C+'" value=""/>'}}D.append(B);++C}}$("#formMule .dashedBorder").popover({placement:"right",trigger:"hover"});r()}function h(y,x){$("#formMule").find("button:first").click(function(B){B.preventDefault();var C=$(this).parent().find(".task:last"),z=$(this).parent().find(".task").length,A=C.clone();A.find("select").attr("name","tache"+z);A.insertAfter(C);if(z==1){$("#formMule").find("button:odd").removeAttr("disabled")}l(y,x);$("#formMule").find(".listeTache").change(function(){l($(this).val(),x,$(this).parent().next())})});$("#formMule").find("button:odd").click(function(z){z.preventDefault();var A=$(this).parent().find(".task");if(A.length>1){A[A.length-1].remove();if(A.length==2){$(this).attr("disabled","disabled")}}})}function n(A,y,x){var C="";var D=A.find(".tachesApplication").find($("form[name='"+y+"'")).serializeArray();var z=b(x)[y];$(".modal-body").find("#paramsList").children().remove();if(z==undefined){$(".modal-body").find("#paramsList").append("<br><div class='alert alert-warning'>This task cannot be set.</div><button class='btn btn-default pull-right' type='submit'>Save</button>")}else{for(i=0;i<z.length;++i){C+="<li><label for='"+z[i]["nomParams"]+"' class='labelVariable'>"+z[i]["nomParams"]+" :</label><input type='text' id='"+z[i]["nomParams"]+"' name='"+z[i]["idParams"]+"' class='inputVariable valeurDefautParametre' value='"+D[i]["value"]+"' readonly /><input type='hidden' class='valeurMinParametre' value='"+z[i]["minVal"]+"' /><input type='hidden' class='valeurMaxParametre' value='"+z[i]["maxVal"]+"' /><input type='hidden' class='valeurPasParametre' value='"+z[i]["pasVal"]+"' /><div class='sliderParametreApplication'></div></li>"
}var B="<ul><li class='parametresTache'><ul>";B+=C+"</ul></li></ul><button class='btn btn-default pull-right' type='submit'>Save</button>";$(".modal-body").find("#paramsList").append(B)}}function s(E,A,y){var L=p(A),K=0,G=L[y].length,C=3;var x=73;var D=false;if(G>C){contenu='<div class="surContainer" style="height:'+(C*x+25)+'px;">';contenu+="<div class='allDataBox' style='height:"+(C*x+25)+"px;'>";contenu+='<div id="scrollUp"></div>';contenu+='<div id="scrollDown" style="top:'+(C*x+25)+'px;"></div>'}else{contenu="<div class='allDataBox' style='width:90px;height:"+(G*x+25)+"px'>"}if(G>C){E.find(".containerApplication").css("margin-top",(C-1)*x/2+"px");E.find(".ajaxLoaderApplication").css("margin-top",(C-1)*x/2+"px")}else{E.find(".containerApplication").css("margin-top",(G-1)*x/2+"px");E.find(".ajaxLoaderApplication").css("margin-top",(G-1)*x/2+"px")}var z=160/G;for(var F=G,B=0;B<F;++B){contenu+='<div class="dataBoxContainer">';if(L[y][B]["ext"]!="input.txt"){contenu+='<div class="dataBox donneeDataBox" name="tache0data'+K+'" data-html="true" data-toggle="popover" data-content="<span class=\'badge\'>'+L[y][B]["ext"]+"</span> "+L[y][B]["description"]+'" title="'+L[y][B]["nomTypeDonnee"]+'"></div>'}else{contenu+='<input type="txt" name="tache0data'+K+'" class="dataBox input-sm" value="" data-html="true" data-toggle="popover" data-content="'+L[y][B]["description"]+'" title="'+L[y][B]["nomTypeDonnee"]+'"/>'}if(G%2!=0){contenu+='<hr style="transform-origin:left;transform:rotate('+(Math.trunc(G/2)-B)*z+'deg)""></div>'}else{if(B<G/2){contenu+='<hr style="transform-origin:left;transform:rotate('+(G/2-B)*z+'deg)";"></div>'}else{contenu+='<hr style="transform-origin:left;transform:rotate('+(G/2-1-B)*z+'deg)";"></div>'}}++K}if(G>C){contenu+="</div></div><hr>"}else{contenu+="</div><hr>"}E.children(".containerApplication").before(contenu);E.find(".donneeDataBox").droppable({drop:function(O,P){if($(this).children().length==0){var M=O.clientX,N=parseInt($("#overlayGestionnaireDonnees").css("width"));if(P.draggable.parent().attr("id")==="inListeDonneesUser"&&M>N){v(P.draggable.clone(),$(this),2,2)}else{$(this).append(P.draggable);P.draggable.css("position","");P.draggable.css("top",2+"px").css("left",2+"px")}}}});var H=E.find(".allDataBox  .dataBoxContainer .dataBox").length;setTimeout(function(){E.find(".dataBoxContainer").children(".dataBox").show("slice").css("display","inline-block");E.find(".dataBoxContainer hr").css("display","inline-block");E.find(".dataBox").popover({placement:"left",trigger:"hover"}).on("show.bs.popover",function(){$(this).data("bs.popover").tip().css("max-width","250px")})},500);var J=0;E.find("#scrollUp").bind("click",function(M){M.preventDefault();E.find(".allDataBox").animate({scrollTop:"-="+x+"px"})}).bind("mouseover",function(M){D=true;I("up")}).bind("mouseout",function(M){D=false});E.find("#scrollDown").bind("click",function(M){M.preventDefault();E.find(".allDataBox").animate({scrollTop:"+="+x+"px"})}).bind("mouseover",function(M){D=true;I("down")}).bind("mouseout",function(M){D=false});function I(N){var M=(N==="up"?"-=5px":"+=5px");E.find(".allDataBox").animate({scrollTop:M},1,function(){if(D){I(N)}})}}function m(A,z,x){var y=$("#panelSettingsApplication").find(".modal-body");y.find("button").click(function(B){B.preventDefault();A.find(".tachesApplication").find($("form[name='"+x+"'")).children().remove();y.find(".parametresTache ul").find("li").each(function(){A.find(".tachesApplication").find($("form[name='"+x+"'")).append($(this).find("input").first())});$("#panelSettingsApplication").modal("hide")})}function p(z){var C=[];for(var B=0;B<z.length;++B){var x=z[B]["nomTache"];if(x in C==false){C[x]=[]}var y=0;for(var A=0;A<z.length;++A){if(z[A]["nomTache"]===x){C[x][y]=[];C[x][y]["ext"]=z[A]["ext"];C[x][y]["description"]=z[A]["description"];C[x][y]["nomTypeDonnee"]=z[A]["nomTypeDonnee"];y++}}}return C}function b(y){var C=[];for(var B=0;B<y.length;++B){var x=y[B]["nomTache"];if(x in C==false){C[x]=[]}var z=0;for(var A=0;A<y.length;++A){if(y[A]["nomTache"]===x){C[x][z]=[];C[x][z]["idParams"]=y[A]["idParams"];C[x][z]["nomParams"]=y[A]["nomParams"];C[x][z]["defaultVal"]=y[A]["defaultVal"];C[x][z]["minVal"]=y[A]["minVal"];C[x][z]["maxVal"]=y[A]["maxVal"];C[x][z]["pasVal"]=y[A]["pasVal"];z++}}}return C}$("#boutonFullScreen").click(function(){var x=$(this);if(screenfull.enabled){function z(A){A.target.removeEventListener(A.type,arguments.callee);if(screenfull.isFullscreen){x.removeClass("glyphicon-fullscreen").addClass("glyphicon-resize-small");x.attr("data-original-title","Normal screen mode")}else{x.removeClass("glyphicon-resize-small").addClass("glyphicon-fullscreen");x.attr("data-original-title","Full screen mode")}}function y(B){B.target.removeEventListener(B.type,arguments.callee);var A={erreurs:"<p>Failed to enable fullscreen. Your browser is not supported.</p>"};displayInformationsClient(A)}document.addEventListener(screenfull.raw.fullscreenerror,y);screenfull.toggle();document.addEventListener(screenfull.raw.fullscreenchange,z)
}});$("#overlayAfficherDonnee").find(".modal-body a").click(function(y){var x=$(y.target).attr("href");if(x==="#graphResult"){$("#labelSubmitUpdateData").attr("for","submitUpdateData");$("#labelSubmitUpdateData img").css("opacity","1").css("cursor","pointer").attr("data-content","Update this data")}else{$("#labelSubmitUpdateData").attr("for","");$("#labelSubmitUpdateData img").css("opacity","0.2").css("cursor","default").attr("data-content","")}});$("#formUpdateData").on("submit",function(x){$("#image-waiter").show();$("#labelSubmitUpdateData").attr("for","");$("#labelSubmitUpdateData img").css("opacity","0.2").css("cursor","default").attr("data-content","");x.preventDefault();$(this).find("#debutDonnee").attr("value",namespaceGraphData.tmin);$(this).find("#finDonnee").attr("value",namespaceGraphData.tmax);$(this).find("#rowSelected").attr("value",JSON.stringify(namespaceGraphData.rowSelected));$.ajax({url:"/HandleData/UpdateData",type:"POST",async:true,cache:false,processData:false,data:$(this).serialize(),success:function(y){y=JSON.parse(y);displayInformationsClient(y);$("#overlayAfficherDonnee").modal("hide");$("#labelSubmitUpdateData").attr("for","submitUpdateData");$("#labelSubmitUpdateData img").css("opacity","1").css("cursor","pointer").attr("data-content","Update this data")},error:function(){var y={erreurs:"<p>A system error has occurred.</p>"};displayInformationsClient(y);$("#labelSubmitUpdateData").attr("for","submitUpdateData");$("#labelSubmitUpdateData img").css("opacity","1").css("cursor","pointer").attr("data-content","Update this data")}})})}});var namespaceGraphData={},namespaceGraphLocalData={};function graphLocalData(t,j,q){if(t.get_name()==="EDFFile"||t.get_name()==="TXTFile"){if(t.get_name()==="EDFFile"){var d=parseInt(t.get_header_item("num_signals_in_data_record")),e=Math.round(t.get_signal_item(0,"num_samples_in_data_record")/t.get_header_item("duration_of_data_record")),h=Math.round(t.get_header_item("num_data_records")*e),m=0,g=t.get_header_item("num_data_records")}else{if(t.get_name()==="TXTFile"){var d=t.get_number_of_signals(),e=t.get_sample_rate(),h=t.get_size_signals(),m=0,g=h}}var n=[],f=t.get_legend(),k=false,a=true,o=true;n[0]=0;namespaceGraphLocalData.tmin=0;namespaceGraphLocalData.tmax=namespaceGraphLocalData.tmin+Math.round(j/e)-1;if(namespaceGraphLocalData.tmax>g){namespaceGraphLocalData.tmax=g-1}namespaceGraphLocalData.dataForForm={data:t.get_series(),rowSelected:n,legend:f,sampleRate:e,minimum:namespaceGraphLocalData.tmin,maximum:namespaceGraphLocalData.tmax};function s(v,c){if(v<namespaceGraphLocalData.tmin||c>namespaceGraphLocalData.tmax){var u=$(q).find(".graphResult").highcharts();$("#labelSubmitLocalData").attr("for","");$("#labelSubmitLocalData img").css("opacity","0.2").css("cursor","default").attr("data-content","");$("#labelFileLocalData").attr("for","");$("#labelFileLocalData img").css("opacity","0.2").css("cursor","default").attr("data-content","");namespaceGraphLocalData.tmin=v;namespaceGraphLocalData.tmax=c;u.showLoading('<span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Loading data...');setTimeout(function(){try{var y=t.get_all_signals_data(v,c);for(var x=0,A=d;x<A;++x){u.get(f[x]+"-serie").setData(y[x])}namespaceGraphLocalData.dataForForm.data=y}catch(z){var w={erreurs:"<p>A system error has occurred: "+z+"</p>"};displayInformationsClient(w)}u.hideLoading();$("#labelSubmitLocalData").attr("for","submitLocalData");$("#labelSubmitLocalData img").css("opacity","1").css("cursor","pointer").attr("data-content","Load this data");$("#labelFileLocalData").attr("for","fileLocalData");$("#labelFileLocalData img").css("opacity","1").css("cursor","pointer").attr("data-content","Add a new data")},10)}namespaceGraphLocalData.dataForForm.minimum=v;namespaceGraphLocalData.dataForForm.maximum=c}$(q).find(".graphResult").highcharts("StockChart",{chart:{reflow:false,animation:false,zoomType:"x",height:parseInt($("html").css("height"))*0.7,width:parseInt($("html").css("width"))*0.86},credits:{enabled:false},tooltip:{enabled:false,animation:false},navigator:{adaptToUpdatedData:false,series:{id:"navigator",data:t.get_navigator()},xAxis:{labels:{formatter:function(){return Math.round(this.value/(1000*e)*100)/100}}}},legend:{enabled:true},plotOptions:{line:{animation:false,stickyTracking:true,shadow:false,dataLabels:{enabled:false,style:{textShadow:false}},enableMouseTracking:false},series:{animation:false,enableMouseTracking:false,stickyTracking:true,shadow:false,dataLabels:{style:{textShadow:false}},events:{legendItemClick:function(v){var u=f.indexOf(this.name);if(u!=-1){if(this.visible){var c=n.indexOf(u);n.splice(c,1)}else{n.push(u);n.sort(function(x,w){if(x<w){return -1}else{if(x>w){return 1}else{return 0}}})}namespaceGraphLocalData.dataForForm.rowSelected=n}}},lineWidth:1}},scrollbar:{liveRedraw:false},title:null,rangeSelector:{buttons:[{type:"all",text:"All"}],inputEnabled:false,selected:1},loading:{style:{position:"absolute",backgroundColor:"white",opacity:0.7,textAlign:"center"},labelStyle:{position:"relative",top:"0",color:"black",fontSize:"1em",fontWeight:"normal"}},xAxis:{events:{setExtremes:function(v){if(typeof v.min=="undefined"&&typeof v.max=="undefined"){s(m,g)
}else{if(typeof v.min=="undefined"){s(m,v.max)}else{if(typeof v.max=="undefined"){s(v.min,g)}else{var c=Math.round(v.min/(1000*e)),w=Math.round(v.max/(1000*e));if((w-c)*e>t.get_limit_points_display()+1000){var u=$(q).find(".graphResult").highcharts();setTimeout(function(){u.xAxis[0].setExtremes(c*1000*e,t.get_limit_points_display()*1000+c*1000*e);var x={erreurs:"<p>The data interval has been adjusted automatically for a better display.</p>"};displayInformationsClient(x)},1)}else{s(c,w)}}}}}},labels:{formatter:function(){return Math.round(this.value/(1000*e)*100)/100}}}});var l=$(q).find(".graphResult").highcharts();if(d>4){o=false}for(var p=0,r=d;p<r;++p){if(p%2==0){k=false}else{k=true}l.addAxis({id:f[p]+"-axis",gridLineWidth:0,title:{text:f[p],style:{color:Highcharts.getOptions().colors[p]},enabled:o},labels:{formatter:function(){return this.value},style:{color:Highcharts.getOptions().colors[p]},enabled:o},opposite:k});l.addSeries({name:f[p],yAxis:f[p]+"-axis",id:f[p]+"-serie",visible:a,data:t.get_series(p)});a=false}}else{var b={erreurs:"<p>[JS] No object has been identified.</p>"};displayInformationsClient(b)}}function graphData(a){function b(d,c){namespaceGraphData.tmin=d/1000;namespaceGraphData.tmax=c/1000;var d=Math.round(d/1000),c=Math.round(c/1000);if(d<namespaceGraphData.startTime||c>namespaceGraphData.endTime){$("#labelSubmitUpdateData").attr("for","");$("#labelSubmitUpdateData img").css("opacity","0.2").css("cursor","default").attr("data-content","");var e=$("#overlayAfficherDonnee").find(".graphResult").highcharts();e.showLoading('<span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Loading data...');namespaceGraphData.startTime=d;namespaceGraphData.endTime=c;$.getJSON("/HandleData/SendDataForHighStock/idDonnee="+a.idDonneeUtilisateur+"debutDonnee="+d+"finDonnee="+c,function(f){var h=f.data;for(var g=0,j=namespaceGraphData.numSignal;g<j;++g){e.get(namespaceGraphData.legende[g]+"-serie").setData(h[g])}e.hideLoading()});$("#labelSubmitUpdateData").attr("for","submitUpdateData");$("#labelSubmitUpdateData img").css("opacity","1").css("cursor","pointer").attr("data-content","Update this data")}}$.getJSON("/HandleData/SendDataForHighStock/idDonnee="+a.idDonneeUtilisateur,function(g){$("#image-waiter").hide();if(g.erreurs){displayInformationsClient(g)}else{var k=$("#overlayAfficherDonnee").find(".graphResult").hasClass("active");if(k){$("#labelSubmitUpdateData").attr("for","submitUpdateData");$("#labelSubmitUpdateData img").css("opacity","1").css("cursor","pointer").attr("data-content","Update this data")}var j=[],f=false,d=true,o=true,l=g.serieNavigator;namespaceGraphData.startTime=g.startTime;namespaceGraphData.endTime=g.endTime;namespaceGraphData.legende=g.legende;namespaceGraphData.numSignal=namespaceGraphData.legende.length;namespaceGraphData.sampleRate=g.sampleRate;namespaceGraphData.tailleSignal=g.tailleSignal;namespaceGraphData.rowSelected=[];namespaceGraphData.tmin=namespaceGraphData.startTime;namespaceGraphData.tmax=namespaceGraphData.endTime;for(var h=0;h<namespaceGraphData.numSignal;++h){j[h]=g.data[h]}namespaceGraphData.rowSelected[0]=0;var e=new TXTFile();e.set_series(j);e.set_legend(g.legende);tableData(e,"#overlayAfficherDonnee");$("#overlayAfficherDonnee").find(".graphResult").highcharts("StockChart",{chart:{reflow:false,animation:false,zoomType:"x",height:parseInt($("html").css("height"))*0.7,width:parseInt($("html").css("width"))*0.86},credits:{enabled:false},tooltip:{enabled:false,animation:false},navigator:{adaptToUpdatedData:false,series:{id:"navigator",data:l},xAxis:{labels:{formatter:function(){return Math.round(this.value/(1000*namespaceGraphData.sampleRate)*100)/100}}}},legend:{enabled:true},plotOptions:{line:{animation:false,stickyTracking:true,shadow:false,dataLabels:{enabled:false,style:{textShadow:false}},enableMouseTracking:false},series:{animation:false,enableMouseTracking:false,stickyTracking:true,shadow:false,events:{legendItemClick:function(q){var p=namespaceGraphData.legende.indexOf(this.name);if(p!=-1){if(this.visible){var c=namespaceGraphData.rowSelected.indexOf(p);namespaceGraphData.rowSelected.splice(c,1)}else{namespaceGraphData.rowSelected.push(p);namespaceGraphData.rowSelected.sort(function(s,r){if(s<r){return -1}else{if(s>r){return 1}else{return 0}}})}}}},lineWidth:1}},scrollbar:{liveRedraw:false},rangeSelector:{buttons:[{type:"all",text:"All"}],inputEnabled:false,selected:1},loading:{style:{position:"absolute",backgroundColor:"white",opacity:0.6,textAlign:"center"},labelStyle:{position:"relative",top:"0",color:"black",fontSize:"1em",fontWeight:"normal"}},xAxis:{events:{setExtremes:function(c){if(typeof c.min=="undefined"&&typeof c.max=="undefined"){b(0,30000)}else{if(typeof c.min=="undefined"){b(0,c.max)}else{if(typeof c.max=="undefined"){b(c.min,30000)}else{b(c.min,c.max)}}}}},labels:{formatter:function(){return Math.round(this.value/(1000*namespaceGraphData.sampleRate)*100)/100}}}});var m=$("#overlayAfficherDonnee").find(".graphResult").highcharts();
if(namespaceGraphData.numSignal>4){o=false}for(var h=0,n=namespaceGraphData.numSignal;h<n;++h){if(h%2==0){f=false}else{f=true}m.addAxis({id:namespaceGraphData.legende[h]+"-axis",gridLineWidth:0,title:{text:namespaceGraphData.legende[h],style:{color:Highcharts.getOptions().colors[h]},enabled:o},labels:{formatter:function(){return this.value},style:{color:Highcharts.getOptions().colors[h]},enabled:o},opposite:f});m.addSeries({name:namespaceGraphData.legende[h],yAxis:namespaceGraphData.legende[h]+"-axis",id:namespaceGraphData.legende[h]+"-serie",visible:d,data:j[h]});d=false}}})}function openGestionnaireDonnees(){var c=$("#boutonShowGestionnaireDonnees"),f=$("#overlayGestionnaireDonnees"),e=-parseInt(f.css("width")),b=0;if(parseInt(f.css("left"))>=b){var a=parseInt($("#overlayGestionnaireDonnees").css("width")),d=parseInt($("#boutonShowGestionnaireDonnees").css("left"));if(a>500){$("#overlayGestionnaireDonnees").animate({width:a-400},1500);$("#boutonShowGestionnaireDonnees").animate({left:d-400},1500);$("#laMule").hide();$("#formMule").find(".form-group").empty()}else{f.animate({left:e},1500);c.animate({left:b},1500);setTimeout(function(){$("#inListeDonneesUser").empty()},1500);dataManagerAlreadyOpened=false}}else{$.ajax({url:"/HandleData/GestionnaireDeDonnees",type:"POST",success:function(g){try{g=JSON.parse(g);$("#inListeDonneesUser").html(g.listeDonneeUtilisateur);dataManagerAlreadyOpened=true;if(!addDataAlreadyLoaded){addData();addDataAlreadyLoaded=true}var h={tailleMoDonneesUtilisateur:g.tailleMoDonneesUtilisateur,tailleMaxDonneesUtilisateur:g.tailleMaxDonneesUtilisateur,progressionPourcent:g.progressionPourcent};showData(h)}catch(j){var g={};g.erreurs="<p>A system error has occurred.</p>";displayInformationsClient(g)}},error:function(){var g={};g.erreurs="<p>A system error has occurred.</p>";displayInformationsClient(g)}});f.animate({left:b},1500);c.animate({left:-e},1500)}}function showData(a){var b=$("#sectionGestionnaireDonnees .donneeUser");$(".donneeUser").each(function(c,f){var d=$(f).parent();if(!d.hasClass("dashedBorder")){$(f).popover({placement:"bottom",trigger:"hover"})}});b.draggable({snap:".dataBox",revert:true,scroll:false,helper:function(){$copy=$(this).clone();return $copy},drag:function(c,d){$(this).popover("hide")}});if(typeof(a)!="undefined"){$("#progressBarEspaceDisponibleData").attr("value",a.tailleMoDonneesUtilisateur);$("#progressBarEspaceDisponibleData").attr("max",a.tailleMaxDonneesUtilisateur);$("#progressionPourcent").html(a.progressionPourcent+"%")}b.on("click",function(){forShowingData($(this))});forSavingData();forDeletingData()}function forShowingData(a){var b=$("#overlayAfficherDonnee");$("#image-waiter").show();$("#labelSubmitUpdateData").attr("for","");$("#labelSubmitUpdateData img").css("opacity","0.2").css("cursor","default").attr("data-content","");b.find(".tableResult table").empty();b.find(".graphResult").empty();b.find(".row last").empty();b.find(".row first").empty();b.find(".row:nth-child(2)").empty();b.find(".row:first").addClass("hidden");b.find(".row:last").addClass("hidden");b.modal("show");$.ajax({url:"/HandleData/ShowData",type:"POST",async:true,cache:false,data:{idDonneeUtilisateur:a.attr("id")},success:function(c){c=JSON.parse(c);if(c.erreurs){displayInformationsClient(c);b.modal("hide")}else{b.find("#idDonneeUtilisateur").attr("value",c.idDonneeUtilisateur);if(c.imageStandard){$("#image-waiter").hide();b.find(".row:nth-child(2)").html(c.imageStandard)}else{if(c.imageDicom){$("#image-waiter").hide();var g=b.find(".row:nth-child(2)").get(0),k=base64toBlob(c.imageDicom,"application/dicom");try{cornerstone.enable(g);cornerstone.loadImage(k).then(function(l){var e=cornerstone.getDefaultViewportForImage(g,l);cornerstone.displayImage(g,l,e);cornerstoneTools.mouseInput.enable(g);cornerstoneTools.mouseWheelInput.enable(g);cornerstoneTools.wwwc.activate(g,1);cornerstoneTools.pan.activate(g,2);cornerstoneTools.zoom.activate(g,4);cornerstoneTools.zoomWheel.activate(g)},function(m){var l={erreurs:"<p>[JS] A system error has occured: "+m+"</p>"};displayInformationsClient(l)})}catch(j){var c={erreurs:"<p>[JS] A system error has occured: "+j+"</p>"};displayInformationsClient(c)}}else{if(c.dataFile&&c.ext){$("#image-waiter").hide();b.find(".row:last").removeClass("hidden");var g=b.find(".row:last"),h=ace.edit(g[0]),f=c.ext.toLowerCase(),d=base64_decode(c.dataFile);h.$blockScrolling=Infinity;h.setHighlightActiveLine(true);h.setValue(d,1);h.setTheme("ace/theme/monokai");h.getSession().setMode("ace/mode/"+f)}else{b.find(".row:first").removeClass("hidden");graphData(c)}}}}},error:function(){var c={erreurs:"<p>A system error has occurred.</p>"};displayInformationsClient(c);$("#labelSubmitUpdateData").attr("for","submitUpdateData");$("#labelSubmitUpdateData img").css("opacity","1").css("cursor","pointer").attr("data-content","Update this data")}})}function forSavingData(){$("#boutonSaveDataOnServer").droppable({drop:function(a,b){$.post("/HandleData/SaveDataOnServer",{idDonneeUtilisateur:b.draggable.attr("id")},function(c){c=JSON.parse(c);
if(c.erreurs){displayInformationsClient(c)}else{if(c.reussites){$("#inListeDonneesUser").html(c.listeDonneeUtilisateur);showData();displayInformationsClient(c)}}})}})}function forDeletingData(){$("#poubelleDonneeUtilisateur").droppable({drop:function(a,b){$.post("/HandleData/DeleteData",{idDonneeUtilisateur:b.draggable.attr("id")},function(c){c=JSON.parse(c);if(c.erreurs){displayInformationsClient(c)}else{if(c.reussites){displayInformationsClient(c)}}$("#noospace .donneeUser").each(function(){if($(this).attr("id")===b.draggable.attr("id")){$(this).remove()}});b.draggable.remove();$("#progressBarEspaceDisponibleData").attr("value",c.tailleMoDonneesUtilisateur);$("#progressBarEspaceDisponibleData").attr("max",c.tailleMaxDonneesUtilisateur);$("#progressionPourcent").html(c.progressionPourcent+"%")})}})}function tableToCSV(f,g){if(Array.isArray(f)&&Array.isArray(g)){var d="",h=g.length,b=f.length,a=g[h-1].length;for(var c=0;c<b;++c){if(c===b-1){d+=f[c]}else{d+=f[c]+";"}}d+="\r\n";for(var c=0;c<a;++c){for(var e=0;e<h;++e){if(e===h-1){d+=g[e][c]}else{d+=g[e][c]+";"}}d+="\r\n"}return d}else{console.log("tableToCSV::legend or table is not an array.")}}function tableData(e,b){var n=$(b).find(".tableResult table");n.empty();n.append("<thead><tr></tr></thead><tbody></tbody>");var h=n.find("thead tr"),f=n.find("tbody"),l,k,m;if(e.get_name()==="TXTFile"){l=e.get_size_signals()}else{if(e.get_name()==="EDFFile"){k=Math.round(e.get_signal_item(0,"num_samples_in_data_record")/e.get_header_item("duration_of_data_record"));l=Math.round(e.get_header_item("num_data_records")*k)}}if(l>50){l=50}for(var d=0,g=e.get_legend().length;d<g;++d){h.append("<th>"+e.get_legend()[d]+"</th>")}for(var d=0;d<l;++d){m+="<tr>";for(var a=0,g=e.get_series().length;a<g;++a){m+="<td>"+e.get_series()[a][d][1]+"</td>"}m+="</tr>"}if(l===50){m+="<tr>";for(var a=0,g=e.get_series().length;a<g;++a){m+="<td>...</td>"}m+="</tr>"}f.append(m)}function base64_decode(n){var b=function(q){return decodeURIComponent(q.split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join(""))};if(typeof window!=="undefined"){if(typeof window.atob!=="undefined"){return b(window.atob(n))}}else{return new Buffer(n,"base64").toString("utf-8")}var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var d;var c;var a;var m;var l;var k;var j;var o;var h=0;var p=0;var f="";var g=[];if(!n){return n}n+="";do{m=e.indexOf(n.charAt(h++));l=e.indexOf(n.charAt(h++));k=e.indexOf(n.charAt(h++));j=e.indexOf(n.charAt(h++));o=m<<18|l<<12|k<<6|j;d=o>>16&255;c=o>>8&255;a=o&255;if(k===64){g[p++]=String.fromCharCode(d)}else{if(j===64){g[p++]=String.fromCharCode(d,c)}else{g[p++]=String.fromCharCode(d,c,a)}}}while(h<n.length);f=g.join("");return b(f.replace(/\0+$/,""))}function base64toBlob(c,m){m=m||"";var b=1024;var j=atob(c);var l=j.length;var h=Math.ceil(l/b);var k=new Array(h);for(var d=0;d<h;++d){var a=d*b;var e=Math.min(a+b,l);var n=new Array(e-a);for(var f=a,g=0;f<e;++g,++f){n[g]=j[f].charCodeAt(0)}k[d]=new Uint8Array(n)}return new Blob(k,{type:m})}function sliderParametreApplication(a){a.find(".sliderParametreApplication").each(function(){var b=parseInt($(this).parent().find(".valeurDefautParametre").attr("value")),c=parseInt($(this).parent().find(".valeurMinParametre").attr("value")),e=parseInt($(this).parent().find(".valeurMaxParametre").attr("value")),d=parseInt($(this).parent().find(".valeurPasParametre").attr("value"));$(this).slider({range:"min",min:c,max:e,value:b,step:d,slide:function(f,g){$(this).parent().find(".valeurDefautParametre").attr("value",g.value)}})})};