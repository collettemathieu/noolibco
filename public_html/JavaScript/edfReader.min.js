var _header_spec,_signal_spec,_signals=[];_header_spec=[{name:"version",length:8},{name:"patient_id",length:80},{name:"recording_id",length:80},{name:"start_date",length:8},{name:"start_time",length:8},{name:"number_of_bytes",length:8},{name:"reserved",length:44},{name:"num_data_records",length:8},{name:"duration_of_data_record",length:8},{name:"num_signals_in_data_record",length:4}];_signal_spec=[{name:"label",length:16},{name:"transducer_type",length:80},{name:"physical_dimensions",length:8},{name:"physical_min",length:8},{name:"physical_max",length:8},{name:"digital_min",length:8},{name:"digital_max",length:8},{name:"prefiltering",length:80},{name:"num_samples_in_data_record",length:8}];function EDFFile(h){var f,e,d,b,a,g,c;this.edf_path=h;_signals=[];this._handle=this.edf_path;this._header_item={};this._signal_item={};for(e=d=0,g=parseInt(this.get_header_item("num_signals_in_data_record"));0<=g?d<=g:d>=g;e=0<=g?++d:--d){f={};for(b=0,a=_signal_spec.length;b<a;++b){c=_signal_spec[b];f[c.name]=this.get_signal_item(e,c.name)}_signals.push(f)}}EDFFile.prototype.get_name=function(){return"EDFFile"};EDFFile.prototype.get_legend=function(){return this.legend};EDFFile.prototype.get_series=function(a){if(typeof a==="number"){return this.series[a]}else{return this.series}};EDFFile.prototype.get_navigator=function(){return this.serieNavigator};EDFFile.prototype.get_limit_points_display=function(){return 40000};EDFFile.prototype.get_header_offset=function(){return 256+(this.get_header_item("num_signals_in_data_record")*256)};EDFFile.prototype.get_file_duration=function(){return this.get_header_item("duration_of_data_record")*this.get_header_item("num_data_records")};EDFFile.prototype._get_header_spec=function(f){var d,e,c,b,a;b=0;for(e=0,c=_header_spec.length;e<c;++e){a=_header_spec[e];if(a.name===f){d=a;d.position=b;return d}else{b+=a.length}}};EDFFile.prototype._get_signal_spec=function(g,f){var d,e,c,b,a;b=256;for(e=0,c=_signal_spec.length;e<c;++e){a=_signal_spec[e];if(a.name===f){d=a;d.position=b+(a.length*g);return d}else{b+=this.get_header_item("num_signals_in_data_record")*a.length}}};EDFFile.prototype._get_signal_obj=function(b){var a;a=_signals[b];a.gain=(parseFloat(a.physical_max)-parseFloat(a.physical_min))/(parseFloat(a.digital_max)-parseFloat(a.digital_min));a.offset=(a.physical_max/a.gain)-a.digital_max;a.sample_rate=a.num_samples_in_data_record/this.get_header_item("duration_of_data_record");return a};EDFFile.prototype._get_buffer_slice=function(c,a){var b=this._handle.slice(a,a+c);return b};EDFFile.prototype.get_header_item=function(b){var a;if(this._header_item[b]!=null){return this._header_item[b]}a=this._get_header_spec(b);var e=new Int8Array(this._get_buffer_slice(a.length,a.position)),g=[];for(var d=0,f=e.length;d<f;++d){g[d]=String.fromCharCode(e[d])}this._header_item[b]=g.join("").trim();return this._header_item[b]};EDFFile.prototype.get_signal_item=function(g,b){var e,a;e=b+"_"+g;if(this._signal_item[e]!=null){return this._signal_item[e]}a=this._get_signal_spec(g,b);var f=new Int8Array(this._get_buffer_slice(a.length,a.position)),k=[];for(var d=0,h=f.length;d<h;++d){k[d]=String.fromCharCode(f[d])}this._signal_item[e]=k.join("").trim();return this._signal_item[e]};EDFFile.prototype.get_signal_data=function(D,f,c){var G,I,e,d,q,o,b,t,u,s,a,h,B,A,z,C,k,y,x,H,w,v,E,g,r,F;if(Array.isArray(D)){G=[];for(A=0,C=D.length;A<C;++A){d=D[A];G.push(this.get_signal_data(d,f,c))}return G}if(_signals[D]==null){throw new Error("Invalid Signal index specified.")}o=0;for(z=0,k=_signals.length;z<k;++z){e=_signals[z];o+=e.num_samples_in_data_record*this.get_header_item("duration_of_data_record")*2}F=c-f;t=Math.ceil(F/this.get_header_item("duration_of_data_record"));s=0;for(d=y=0,g=D;0<=g?y<g:y>g;d=0<=g?++y:--y){s+=this.get_signal_item(d,"num_samples_in_data_record")*2}a=this.get_signal_item(d,"num_samples_in_data_record")*2;E=f*this.get_header_item("duration_of_data_record");q=(E*o)+this.get_header_offset();e=this._get_signal_obj(D);I=[];for(B=x=0,r=t;0<=r?x<r:x>r;B=0<=r?++x:--x){u=this._get_buffer_slice(a,q+(B*o)+s);b=(E+B)*this.get_header_item("duration_of_data_record");w=0;while(w<u.byteLength){v=new Int16Array(u.slice(w,w+2));H=(v[0]+e.offset)*e.gain;h=b+(w/2)/e.sample_rate;I.push({time:h,data:H});w+=2}}return I};EDFFile.prototype.get_all_signals_data=function(g,d){var b=this.get_header_item("num_signals_in_data_record"),c=Math.round(this.get_signal_item(0,"num_samples_in_data_record")/this.get_header_item("duration_of_data_record")),B=[],u=[],s=[],a=[],f=[],n=[],q=0,F=d-g,t=Math.ceil(F/this.get_header_item("duration_of_data_record")),E=g*this.get_header_item("duration_of_data_record"),D=j=0,y=[];var e,C,r,x,w,v,h;for(var z=0,o=_signals.length;z<o;++z){f=_signals[z];q+=f.num_samples_in_data_record*this.get_header_item("duration_of_data_record")*2}r=(E*q)+this.get_header_offset();for(var A=0;A<b;++A){s[A]=0;signal_index=A;B[A]=[];for(var e=x=0,h=signal_index;0<=h?x<h:x>h;e=0<=h?++x:--x){s[A]+=this.get_signal_item(e,"num_samples_in_data_record")*2
}a[A]=this.get_signal_item(e,"num_samples_in_data_record")*2;f[A]=this._get_signal_obj(signal_index)}while(D<=t){for(var A=0;A<b;++A){u[A]=this._get_buffer_slice(a[A],r+(D*q)+s[A]);n[A]=parseInt(u[A].byteLength)}C=Math.max.apply(null,n);w=0;while(w<=C){y=[];for(var A=0;A<b;++A){if(w<n[A]-2){v=new Int16Array(u[A].slice(w,w+2));y[A]=(v[0]+f[A].offset)*f[A].gain}else{y[A]=0}}for(var A=0;A<b;++A){B[A][j]=[(g+j/c)*1000*c,y[A]]}w+=2;++j}++D}return B};EDFFile.prototype.get_view_signals_data=function(v){var c=this.get_header_item("num_signals_in_data_record"),e=Math.round(this.get_signal_item(0,"num_samples_in_data_record")/this.get_header_item("duration_of_data_record")),F=[],s=[],d=[],y=[],x=[],a=[],h=[],q=[],n=0,g=this.get_header_item("num_data_records"),K=0,b=K+Math.round(v/e),C=[],t=0,J=g-n,w=Math.ceil(J/this.get_header_item("duration_of_data_record")),I=n*this.get_header_item("duration_of_data_record"),H=j=0;var f,G,u,B,A,z,o,L;if(b>g){b=g}for(var D=0,r=_signals.length;D<r;++D){h=_signals[D];t+=h.num_samples_in_data_record*this.get_header_item("duration_of_data_record")*2}u=(I*t)+this.get_header_offset();for(var E=0;E<c;++E){x[E]=0;signal_index=E;F[E]=[];d[E]=this.get_signal_item(E,"label");for(var f=B=0,o=signal_index;0<=o?B<o:B>o;f=0<=o?++B:--B){x[E]+=this.get_signal_item(f,"num_samples_in_data_record")*2}a[E]=this.get_signal_item(f,"num_samples_in_data_record")*2;h[E]=this._get_signal_obj(signal_index)}while(H<w){for(var E=0;E<c;++E){y[E]=this._get_buffer_slice(a[E],u+(H*t)+x[E]);q[E]=parseInt(y[E].byteLength)}A=0;if(H<K||H>b){z=new Int16Array(y[0].slice(A,A+2));L=(z[0]+h[0].offset)*h[0].gain;s[H]=[H*1000*e,parseFloat(L)]}else{G=Math.max.apply(null,q);while(A<=G){C=[];for(var E=0;E<c;++E){if(A<q[E]-2){z=new Int16Array(y[E].slice(A,A+2));C[E]=(z[0]+h[E].offset)*h[E].gain}else{C[E]=0}}for(var E=0;E<c;++E){F[E][j]=[(K+j/e)*1000*e,C[E]]}if(A==0){s[H]=[H*1000*e,parseFloat(C[0])]}A+=2;++j}}++H}this.legend=d;this.series=F;this.serieNavigator=s};