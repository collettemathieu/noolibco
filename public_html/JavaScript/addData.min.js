function addData(){var a=$("#overlayFormulaireAjoutDonneeLocale");$("#image-local-waiter").hide();$("#labelFileLocalData img").attr("data-content","Add a new data item");$("#fileLocalData").change(function(){if(this.files.length==1){uploadAllowed=true;$("#labelSubmitLocalData").attr("for","");$("#labelSubmitLocalData img").css("opacity","0.2").css("cursor","default").attr("data-content","");$("#labelFileLocalData").attr("for","");$("#labelFileLocalData img").css("opacity","0.2").css("cursor","default").attr("data-content","");a.find(".modal-body .row:first").addClass("hidden");a.find(".modal-body .row:first .tableResult table").empty();a.find(".modal-body .row:first .graphResult").empty();a.find(".modal-body .row:last").empty();$("#image-local-waiter").show();$("#localData").attr("value","");$("#nomFichierData").attr("value","");$("#extensionFichierData").attr("value","");delete namespaceGraphLocalData.dataForForm;var e=new FileReader(),k=["bmp","jpg","jpeg","png","gif","jpeg2000"],b=["dcm"],g=["csv"],h=["txt"],c=["edf","edf+"],j=this.files[0].name;var i=j.split(".");i=i[i.length-1].toLowerCase();$("#nomFichierData").attr("value",j);if(i=="tiff"){i="tif"}if(i=="jpeg"){i="jpg"}$("#extensionFichierData").attr("value",i);if(k.indexOf(i)!=-1){e.readAsDataURL(this.files[0])}else{if(b.indexOf(i)!=-1){e.readAsDataURL(this.files[0],"UTF-8");var f=cornerstoneWADOImageLoader.fileManager.add(this.files[0])}else{if(g.indexOf(i)!=-1||h.indexOf(i)!=-1){e.readAsText(this.files[0],"UTF-8")}else{if(c.indexOf(i)!=-1){e.readAsArrayBuffer(this.files[0])}else{var d={erreurs:"<p>Sorry, this data cannot be read by NooLib. Please, verify the extension of your data.</p>"};displayInformationsClient(d);closeOverlayLocalData()}}}}if((k.indexOf(i)!=-1||b.indexOf(i)!=-1)&&this.files[0].size>6000000){uploadAllowed=false}e.onload=function(){if(k.indexOf(i)!=-1){var s=new Image();s.src=this.result;a.find(".modal-body .row:last").html(s);$("#localData").attr("value",this.result);$("#sampleRateDonnee").attr("value",0);$("#tailleDonnee").attr("value",0)}else{if(b.indexOf(i)!=-1){var q=a.find(".modal-body .row:last").get(0),n=this.result;try{cornerstone.enable(q);cornerstone.loadImage(f).then(function(u){var t=cornerstone.getDefaultViewportForImage(q,u);cornerstone.displayImage(q,u,t);$("#localData").attr("value",n);$("#sampleRateDonnee").attr("value",0);$("#tailleDonnee").attr("value",0)},function(u){var t={erreurs:"<p>[JS] A system error has occured: "+u+"</p>"};displayInformationsClient(t);a.modal("hide")})}catch(r){var m={erreurs:"<p>[JS] A system error has occured: "+r+"</p>"};displayInformationsClient(m);a.modal("hide")}}else{a.find(".modal-body .row:first").removeClass("hidden");var l=15000;if(g.indexOf(i)!=-1||h.indexOf(i)!=-1){try{var o=new TXTFile(this.result,i);o.get_view_signals_data(l);graphLocalData(o,l,"#overlayFormulaireAjoutDonneeLocale");tableData(o,"#overlayFormulaireAjoutDonneeLocale")}catch(r){var m={erreurs:"<p>Sorry, this file does not contain any data for displaying.</p>"};displayInformationsClient(m);closeOverlayLocalData()}}if(c.indexOf(i)!=-1){try{var p=new EDFFile(this.result);p.get_view_signals_data(l);graphLocalData(p,l,"#overlayFormulaireAjoutDonneeLocale");tableData(p,"#overlayFormulaireAjoutDonneeLocale")}catch(r){var m={erreurs:"<p>A system error has occured: "+r+"</p>"};displayInformationsClient(m);a.modal("hide")}}}}$("#image-local-waiter").hide();$("#labelSubmitLocalData").attr("for","submitLocalData");$("#labelSubmitLocalData img").css("opacity","1").css("cursor","pointer").attr("data-content","Load this data");$("#labelFileLocalData").attr("for","fileLocalData");$("#labelFileLocalData img").css("opacity","1").css("cursor","pointer").attr("data-content","Add a new data")}}});$("#formUploadLocalData").on("submit",function(n){n.preventDefault();$("#image-local-waiter").show();$("#labelSubmitLocalData").attr("for","");$("#labelSubmitLocalData img").css("opacity","0.2").css("cursor","default").attr("data-content","");$("#labelFileLocalData").attr("for","");$("#labelFileLocalData img").css("opacity","0.2").css("cursor","default").attr("data-content","");try{if(typeof namespaceGraphLocalData.dataForForm!="undefined"){var g=[],o=[],j=namespaceGraphLocalData.dataForForm.minimum*namespaceGraphLocalData.dataForForm.sampleRate-namespaceGraphLocalData.dataForForm.data[0][0][0]/1000,q=namespaceGraphLocalData.dataForForm.maximum*namespaceGraphLocalData.dataForForm.sampleRate-namespaceGraphLocalData.dataForForm.data[0][0][0]/1000-1;tailleDonnee=q-j,nombreDonnee=namespaceGraphLocalData.dataForForm.rowSelected.length,sizeAllowed=300000,isTableSelected=a.find(".modal-body .tableResult").hasClass("active");if(isTableSelected){nombreDonnee=namespaceGraphLocalData.dataForForm.data.length;j=0;q=namespaceGraphLocalData.dataForForm.data[0].length;for(var h=0;h<nombreDonnee;++h){namespaceGraphLocalData.dataForForm.rowSelected[h]=h}}if(tailleDonnee*nombreDonnee>sizeAllowed){uploadAllowed=false}else{o[0]="Time";for(var f=0,p=nombreDonnee;
f<p;++f){o[f+1]=namespaceGraphLocalData.dataForForm.legend[namespaceGraphLocalData.dataForForm.rowSelected[f]]}g.push(o);for(var h=j;h<q;++h){o=[];o[0]=namespaceGraphLocalData.dataForForm.data[0][h][0]/(1000*namespaceGraphLocalData.dataForForm.sampleRate);for(var f=0,l=namespaceGraphLocalData.dataForForm.rowSelected.length;f<l;++f){o[f+1]=namespaceGraphLocalData.dataForForm.data[namespaceGraphLocalData.dataForForm.rowSelected[f]][h][1]}g.push(o)}var m=JSON.stringify(g);$("#localData").attr("value",m);$("#sampleRateDonnee").attr("value",namespaceGraphLocalData.dataForForm.sampleRate);$("#tailleDonnee").attr("value",tailleDonnee);$("#tempsMinimumDonneeUtilisateur").attr("value",namespaceGraphLocalData.dataForForm.minimum*namespaceGraphLocalData.dataForForm.sampleRate)}}if(uploadAllowed){var b=new FormData(n.target);$.ajax({url:"/HandleData/AddLocalData",type:"POST",data:b,async:true,cache:false,contentType:false,processData:false,success:function(c){closeOverlayLocalData();try{var c=JSON.parse(c)}catch(k){var c={erreurs:"<p>A system error has occurred: "+k+"</p>"};displayInformationsClient(c)}if(c.reussites){displayInformationsClient(c);$("#inListeDonneesUser").html(c.listeDonneeUtilisateur);var i={tailleMoDonneesUtilisateur:c.tailleMoDonneesUtilisateur,tailleMaxDonneesUtilisateur:c.tailleMaxDonneesUtilisateur,progressionPourcent:c.progressionPourcent};showData(i)}else{if(c.erreurs){displayInformationsClient(c)}}},error:function(k,e,i){var c={erreurs:"<p>The size of data exceeds the limit authorized.</p><p>Please try again with another data.</p>"};displayInformationsClient(c);closeOverlayLocalData()}})}else{var d={erreurs:"<p>The size of data exceeds the limit authorized.</p><p>Please try again with an another data/image or a smaller interval.</p>"};displayInformationsClient(d);$("#image-local-waiter").hide();$("#labelSubmitLocalData").attr("for","submitLocalData");$("#labelSubmitLocalData img").css("opacity","1").css("cursor","pointer").attr("data-content","Load this data");$("#labelFileLocalData").attr("for","fileLocalData");$("#labelFileLocalData img").css("opacity","1").css("cursor","pointer").attr("data-content","Add a new data")}}catch(n){var d={erreurs:"<p>A system error has occurred: "+n+"</p>"};displayInformationsClient(d);closeOverlayLocalData()}})}function closeOverlayLocalData(){$("#image-local-waiter").hide();$("#labelSubmitLocalData").attr("for","");$("#labelSubmitLocalData img").css("opacity","0.2").css("cursor","default").attr("data-content","");$("#labelFileLocalData").attr("for","fileLocalData");$("#labelFileLocalData img").css("opacity","1").css("cursor","pointer").attr("data-content","Add a new data")};