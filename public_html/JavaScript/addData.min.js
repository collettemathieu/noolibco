function addData(){$("#image-local-waiter").hide();$("#labelFileLocalData img").attr("data-content","Add a new data item");$(document).on("dragenter",function(a){a.stopPropagation();a.preventDefault()});$(document).on("dragover",function(a){a.stopPropagation();a.preventDefault();$("#overlayDragAndDropData").fadeIn()});$(document).on("drop",function(a){a.stopPropagation();a.preventDefault();$("#overlayDragAndDropData").fadeOut();if(typeof a.originalEvent.dataTransfer!="undefined"){uploadFile(a.originalEvent.dataTransfer.files);$("#overlayFormulaireAjoutDonneeLocale").modal("show")}});$(document).on("dragleave",function(a){$("#overlayDragAndDropData").fadeOut()});$("#fileLocalData").change(function(){if(this.files.length==1){uploadFile(this.files)}});$("#formUploadLocalData").on("submit",function(m){m.preventDefault();$("#image-local-waiter").show();$("#labelSubmitLocalData").attr("for","");$("#labelSubmitLocalData img").css("opacity","0.2").css("cursor","default").attr("data-content","");$("#labelFileLocalData").attr("for","");$("#labelFileLocalData img").css("opacity","0.2").css("cursor","default").attr("data-content","");try{if(typeof namespaceGraphLocalData.dataForForm!="undefined"){var f=[],n=[],h=namespaceGraphLocalData.dataForForm.minimum*namespaceGraphLocalData.dataForForm.sampleRate-namespaceGraphLocalData.dataForForm.data[0][0][0]/1000,p=namespaceGraphLocalData.dataForForm.maximum*namespaceGraphLocalData.dataForForm.sampleRate-namespaceGraphLocalData.dataForForm.data[0][0][0]/1000-1;tailleDonnee=p-h,nombreDonnee=namespaceGraphLocalData.dataForForm.rowSelected.length,sizeAllowed=300000,isTableSelected=$("#overlayFormulaireAjoutDonneeLocale").find(".modal-body .tableResult").hasClass("active");if(isTableSelected){nombreDonnee=namespaceGraphLocalData.dataForForm.data.length;h=0;p=namespaceGraphLocalData.dataForForm.data[0].length;for(var g=0;g<nombreDonnee;++g){namespaceGraphLocalData.dataForForm.rowSelected[g]=g}}if(tailleDonnee*nombreDonnee>sizeAllowed){uploadAllowed=false}else{n[0]="Time";for(var d=0,o=nombreDonnee;d<o;++d){n[d+1]=namespaceGraphLocalData.dataForForm.legend[namespaceGraphLocalData.dataForForm.rowSelected[d]]}f.push(n);for(var g=h;g<p;++g){n=[];n[0]=namespaceGraphLocalData.dataForForm.data[0][g][0]/(1000*namespaceGraphLocalData.dataForForm.sampleRate);for(var d=0,j=namespaceGraphLocalData.dataForForm.rowSelected.length;d<j;++d){n[d+1]=namespaceGraphLocalData.dataForForm.data[namespaceGraphLocalData.dataForForm.rowSelected[d]][g][1]}f.push(n)}var l=JSON.stringify(f);$("#localData").attr("value",l);$("#sampleRateDonnee").attr("value",namespaceGraphLocalData.dataForForm.sampleRate);$("#tailleDonnee").attr("value",tailleDonnee);$("#tempsMinimumDonneeUtilisateur").attr("value",namespaceGraphLocalData.dataForForm.minimum*namespaceGraphLocalData.dataForForm.sampleRate)}}if(uploadAllowed){var a=new FormData(m.target);$.ajax({url:"/HandleData/AddLocalData",type:"POST",data:a,async:true,cache:false,contentType:false,processData:false,success:function(c){closeOverlayLocalData();try{var c=JSON.parse(c)}catch(k){var c={erreurs:"<p>A system error has occurred: "+k+"</p>"};displayInformationsClient(c)}if(c.reussites){displayInformationsClient(c);$("#inListeDonneesUser").html(c.listeDonneeUtilisateur);var i={tailleMoDonneesUtilisateur:c.tailleMoDonneesUtilisateur,tailleMaxDonneesUtilisateur:c.tailleMaxDonneesUtilisateur,progressionPourcent:c.progressionPourcent};showData(i)}else{if(c.erreurs){displayInformationsClient(c)}}},error:function(k,e,i){var c={erreurs:"<p>The size of data exceeds the limit authorized.</p><p>Please try again with another data.</p>"};displayInformationsClient(c);closeOverlayLocalData()}})}else{var b={erreurs:"<p>The size of data exceeds the limit authorized.</p><p>Please try again with an another data/image or a smaller interval.</p>"};displayInformationsClient(b);$("#image-local-waiter").hide();$("#labelSubmitLocalData").attr("for","submitLocalData");$("#labelSubmitLocalData img").css("opacity","1").css("cursor","pointer").attr("data-content","Load this data");$("#labelFileLocalData").attr("for","fileLocalData");$("#labelFileLocalData img").css("opacity","1").css("cursor","pointer").attr("data-content","Add a new data")}}catch(m){var b={erreurs:"<p>A system error has occurred: "+m+"</p>"};displayInformationsClient(b);closeOverlayLocalData()}})}function closeOverlayLocalData(){$("#image-local-waiter").hide();$("#labelSubmitLocalData").attr("for","");$("#labelSubmitLocalData img").css("opacity","0.2").css("cursor","default").attr("data-content","");$("#labelFileLocalData").attr("for","fileLocalData");$("#labelFileLocalData img").css("opacity","1").css("cursor","pointer").attr("data-content","Add a new data")}function uploadFile(a){uploadAllowed=true;var d=$("#overlayFormulaireAjoutDonneeLocale");$("#labelSubmitLocalData").attr("for","");$("#labelSubmitLocalData img").css("opacity","0.2").css("cursor","default").attr("data-content","");$("#labelFileLocalData").attr("for","");$("#labelFileLocalData img").css("opacity","0.2").css("cursor","default").attr("data-content","");d.find(".modal-body .row:first").addClass("hidden");d.find(".modal-body .row:first .tableResult table").empty();d.find(".modal-body .row:first .graphResult").empty();d.find(".modal-body .row:last").empty();$("#image-local-waiter").show();$("#localData").attr("value","");$("#nomFichierData").attr("value","");$("#extensionFichierData").attr("value","");delete namespaceGraphLocalData.dataForForm;var f=new FileReader(),l=["bmp","jpg","jpeg","png","gif","jpeg2000"],b=["dcm"],h=["csv"],i=["txt"],c=["edf","edf+"],k=a[0].name;var j=k.split(".");j=j[j.length-1].toLowerCase();$("#nomFichierData").attr("value",k);if(j=="tiff"){j="tif"}if(j=="jpeg"){j="jpg"}$("#extensionFichierData").attr("value",j);if(l.indexOf(j)!=-1){f.readAsDataURL(a[0])}else{if(b.indexOf(j)!=-1){f.readAsDataURL(a[0],"UTF-8");var g=cornerstoneWADOImageLoader.fileManager.add(this.files[0])}else{if(h.indexOf(j)!=-1||i.indexOf(j)!=-1){f.readAsText(a[0],"UTF-8")}else{if(c.indexOf(j)!=-1){f.readAsArrayBuffer(a[0])}else{var e={erreurs:"<p>Sorry, this data cannot be read by NooLib. Please, verify the extension of your data.</p>"};displayInformationsClient(e);closeOverlayLocalData()}}}}if((l.indexOf(j)!=-1||b.indexOf(j)!=-1)&&a[0].size>6000000){uploadAllowed=false}f.onload=function(){if(l.indexOf(j)!=-1){var t=new Image();t.src=this.result;d.find(".modal-body .row:last").html(t);$("#localData").attr("value",this.result);$("#sampleRateDonnee").attr("value",0);$("#tailleDonnee").attr("value",0)}else{if(b.indexOf(j)!=-1){var r=d.find(".modal-body .row:last").get(0),o=this.result;try{cornerstone.enable(r);cornerstone.loadImage(g).then(function(v){var u=cornerstone.getDefaultViewportForImage(r,v);cornerstone.displayImage(r,v,u);$("#localData").attr("value",o);$("#sampleRateDonnee").attr("value",0);$("#tailleDonnee").attr("value",0)},function(v){var u={erreurs:"<p>[JS] A system error has occured: "+v+"</p>"};displayInformationsClient(u);d.modal("hide")})}catch(s){var n={erreurs:"<p>[JS] A system error has occured: "+s+"</p>"};displayInformationsClient(n);d.modal("hide")}}else{d.find(".modal-body .row:first").removeClass("hidden");var m=15000;if(h.indexOf(j)!=-1||i.indexOf(j)!=-1){try{var p=new TXTFile(this.result,j);p.get_view_signals_data(m);graphLocalData(p,m,"#overlayFormulaireAjoutDonneeLocale");tableData(p,"#overlayFormulaireAjoutDonneeLocale")}catch(s){var n={erreurs:"<p>Sorry, this file does not contain any data for displaying.</p>"};displayInformationsClient(n);closeOverlayLocalData()}}if(c.indexOf(j)!=-1){try{var q=new EDFFile(this.result);q.get_view_signals_data(m);graphLocalData(q,m,"#overlayFormulaireAjoutDonneeLocale");tableData(q,"#overlayFormulaireAjoutDonneeLocale")}catch(s){var n={erreurs:"<p>A system error has occured: "+s+"</p>"};displayInformationsClient(n);d.modal("hide")}}}}$("#image-local-waiter").hide();$("#labelSubmitLocalData").attr("for","submitLocalData");$("#labelSubmitLocalData img").css("opacity","1").css("cursor","pointer").attr("data-content","Load this data");$("#labelFileLocalData").attr("for","fileLocalData");$("#labelFileLocalData img").css("opacity","1").css("cursor","pointer").attr("data-content","Add a new data")}};